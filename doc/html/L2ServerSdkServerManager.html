<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: SDK Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L2ServerSdkServerManager.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SDK Layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L3ServerSdkServerManOverview">Overview</a></li>
<li class="level1"><a href="#L3ServerSdkServerManManagerInterfaces">Manager Interfaces</a></li>
<li class="level1"><a href="#L3ServerSdkServerManNodeManagersEtc">NodeManagers, the RootNodeManager and the BaseNodeManager</a></li>
<li class="level1"><a href="#L3ServerSdkServerManSessionManagerEtc">SessionManager and Session</a></li>
<li class="level1"><a href="#L3ServerSdkServerManSubscriptionManagerEtc">SubscriptionManager, Subscriptions and MonitoredItems</a></li>
<li class="level1"><a href="#L3ServerSdkServerManServerInternalClient">ServerInternalClient</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L3ServerSdkServerManOverview"></a>
Overview</h1>
<p>Every instance of a UA server has exactly one instance of the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> object. This class is connected with the stack and is the first point of contact for all requests sent by Client applications. When a request arrives, it is validated and dispatched by this object. The handling of a request depends on the service; however, there are two possible design patterns.</p>
<p>If a service does not have a list of operations (CreateSession, CreateSubscription) or if the service is not expected to block on I/O (AddNodes, AddReferences), then the synchronous design pattern is used. In this case a method on the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> is called from a stack thread pool thread and it blocks until processing completes. The response is returned when this method completes. If an exception occurs, the stack will catch it and return a ServiceFault using the information in the exception. The following figure illustrates the synchronous design pattern: </p>
<div class="image">
<img src="serversdkov_serverman_overview.png" alt="serversdkov_serverman_overview.png"/>
</div>
<p>If a service does have a list of operations (Read, Write, Call) and processing could take a lot of time, then the asynchronous design pattern is used. In this case, the begin method is called by the stack thread pool which calls a begin method for each operation. At this point the begin method exits and the thread is released back to the pool. As each operation completes, the thread executing the operation calls the complete method on the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> and the result list is updated. When all operations have been processed, then the response is constructed and returned to the client. The response is sent using the last thread to call the complete method. If the implementer of the logic used to process the operation does not want this thread to be used to send the response, the implementer can tell the SDK to return the response using a stack thread pool thread. The following figure illustrates the asynchronous design pattern: </p>
<div class="image">
<img src="serversdkov_serverman_overview2.png" alt="serversdkov_serverman_overview2.png"/>
</div>
<h1><a class="anchor" id="L3ServerSdkServerManManagerInterfaces"></a>
Manager Interfaces</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> uses the SDK API manager interfaces to implement services which operate on Nodes. Each Node belongs to exactly one NodeManager which implements the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManager.html">INodeManager</a> interface. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> requests the appropriate manager interface for a Node by requesting the handle for the Node via the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManager.html">INodeManager</a>.</p>
<p>A manager interface provides the following methods:</p>
<dl>
<dt>BeginTransaction </dt>
<dd>Starts a transaction. A manager may choose to process multiple operations in a single batch and this method allows the manager to initialize the batch. This method does nothing if the manager does not need to batch operations. </dd>
<dt>Begin&lt;Operation&gt; </dt>
<dd>Starts processing the operation. A manager may simply add the operation to the transaction created with BeginTransaction or it may do all of the processing required and call the Complete method for the operation. </dd>
<dt>FinishTransaction </dt>
<dd>Finishes a transaction. This tells the manager that the all operations have been added and the manager can process the transaction. This method does nothing if the manager processes operations immediately. </dd>
</dl>
<p>The transaction allows the implementer to group operations within a single request. This allows the implementer to optimize I/O by minimizing the requests made to an underlying system. A manager that operates on in-memory nodes would not need transactions and can complete the operation in the Begin&lt;Operation&gt; method. (Completing the operation means the Complete&lt;Operation&gt; callback is called before the Begin&lt;Operation&gt; method returns. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> is designed to expect that some managers will do this).</p>
<p>When the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls the Begin&lt;Operation&gt; method, it passes the OperationHandle which wraps the handle returned from the NodeManager. The manager interface implementation must pass this handle in the Complete&lt;Operation&gt; callback when processing completes.</p>
<p>The following table lists the OPC UA services and which SDK API manager interface is used:</p>
<table class="doxtable">
<tr>
<th>Service Name </th><th>Manager Interface  </th></tr>
<tr>
<td>FindServers </td><td>&mdash; </td></tr>
<tr>
<td>GetEndpoints </td><td>&mdash; </td></tr>
<tr>
<td>CreateSession </td><td>&mdash; </td></tr>
<tr>
<td>ActivateSession </td><td>&mdash; </td></tr>
<tr>
<td>CloseSession </td><td>&mdash; </td></tr>
<tr>
<td>Cancel </td><td>&mdash; </td></tr>
<tr>
<td>Browse </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManager.html">INodeManager</a> </td></tr>
<tr>
<td>BrowseNext </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManager.html">INodeManager</a> </td></tr>
<tr>
<td>TranslateBrowsePathToNodeIds </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManager.html">INodeManager</a> </td></tr>
<tr>
<td>RegisterNodes </td><td>&mdash; </td></tr>
<tr>
<td>UnregisterNodes </td><td>&mdash; </td></tr>
<tr>
<td>Read </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a> </td></tr>
<tr>
<td>Write </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a> </td></tr>
<tr>
<td>HistoryRead (Data) </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IHistoryReadDataManager.html">IHistoryReadDataManager</a> </td></tr>
<tr>
<td>HistoryUpdate (Data) </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IHistoryUpdateDataManager.html">IHistoryUpdateDataManager</a> </td></tr>
<tr>
<td>HistoryRead (Events) </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IHistoryReadEventManager.html">IHistoryReadEventManager</a> </td></tr>
<tr>
<td>HistoryUpdate (Events) </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IHistoryUpdateEventManager.html">IHistoryUpdateEventManager</a> </td></tr>
<tr>
<td>Call </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IMethodManager.html">IMethodManager</a> </td></tr>
<tr>
<td>CreateSubscription </td><td>&mdash; </td></tr>
<tr>
<td>ModifySubscription </td><td>&mdash; </td></tr>
<tr>
<td>DeleteSubscriptions </td><td>&mdash; </td></tr>
<tr>
<td>SetPublishingMode </td><td>&mdash; </td></tr>
<tr>
<td>Publish </td><td>&mdash; </td></tr>
<tr>
<td>Republish </td><td>&mdash; </td></tr>
<tr>
<td>TransferSubscription </td><td>&mdash; </td></tr>
<tr>
<td>CreateMonitoredItems </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a>, <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IEventManager.html">IEventManager</a> </td></tr>
<tr>
<td>ModifyMonitoredItems </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a>, <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IEventManager.html">IEventManager</a> </td></tr>
<tr>
<td>DeleteMonitoredItems </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a>, <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IEventManager.html">IEventManager</a> </td></tr>
<tr>
<td>SetMonitoringMode </td><td><a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a>, <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IEventManager.html">IEventManager</a> </td></tr>
<tr>
<td>SetTriggering </td><td>&mdash; </td></tr>
</table>
<p>If no manager interface is specified for a service, then the SDK handles all of the processing for the service.</p>
<h1><a class="anchor" id="L3ServerSdkServerManNodeManagersEtc"></a>
NodeManagers, the RootNodeManager and the BaseNodeManager</h1>
<p>A NodeManager manages a subset of the Nodes in the Server address space. The NodeManager registers the NamespaceUris of the Nodes it manages with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1RootNodeManager.html">RootNodeManager</a> which will assign a NamespaceIndex to the NamespaceUri. When the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> needs to find a handle for a Node, it calls the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1RootNodeManager.html">RootNodeManager</a> which uses the NamespaceIndex to look up the NodeManager which then provides the handle to the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a>. The assignment of a NamespaceUri to a NodeManager can happen at any time. If a NamespaceUri is already assigned, then the new NodeManager replaces the existing NodeManager.</p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> is a standard implementation for a NodeManager which relies on Nodes stored in the memory. It provides various methods that can be overridden to provide application specific behavior (see the section below for a more detailed explanation). The CoreNodeManager is a subtype of the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> which handles all of the Nodes defined in the specification. It includes logic to manage Nodes required for the diagnostic information defined in Part 5. A User can also use the Node management methods on the CoreNodeManager to add in memory Nodes to NamespaceIndex 1.</p>
<h1><a class="anchor" id="L3ServerSdkServerManSessionManagerEtc"></a>
SessionManager and Session</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1SessionManager.html">SessionManager</a> is responsible for managing the active <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1Session.html">Sessions</a>. The Session maintains the state of the <a class="el" href="L2ClientSdkSession.html">Session created by a client</a>. If a Client disappears, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1Session.html">Session</a> and all resources allocated will be freed by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1SessionManager.html">SessionManager</a> after a timeout period expires.</p>
<p>The Session object also keeps track of the diagnostics information associated with the Session.</p>
<p>Any handles used for registered Nodes are also stored in the Session object and are discarded when the Session is closed.</p>
<h1><a class="anchor" id="L3ServerSdkServerManSubscriptionManagerEtc"></a>
SubscriptionManager, Subscriptions and MonitoredItems</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1SubscriptionManager.html">SubscriptionManager</a> is responsible for managing all of active <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1Subscription.html">Subscriptions</a> and maintaining a queue of Publish requests for each active <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1Session.html">Session</a>. If a Session disappears, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1SubscriptionManager.html">SubscriptionManager</a> will close the Subscriptions belonging to the Session unless they have been transferred to another Session with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1SubscriptionManager.html#a4aa77231bc6069bced396220a24bef85">TransferSubscriptions</a> service.</p>
<p>The Subscription maintains a list of MonitoredItems. When these MonitoredItems have data or events ready to publish, it pulls data/events off the MonitoredItem queue and constructs a NotificationMessage which can be sent back to the client as a part of a Publish response.</p>
<p>The publishing cycle is triggered by a dedicated thread that checks for data to publish every 100&#160;ms (the default, it can be changed with the PublishingIntervalResolution setting in the configuration file). Subscriptions that have data to be published will be called back with a thread from Stack Thread Pool when a Publish request is available for the Session. </p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1MonitoredItem.html">MonitoredItem</a> class maintains a queue for events or data. It is responsible for applying any monitoring filter which is not applied by the source of the data or events. When a MonitoredItem is created the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IIOManager.html">IIOManager</a> or <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IEventManager.html">IEventManager</a> is given a callback to use when data changes or events occur. The MonitoredItem also ensures the sampling rate is honored so sources of data can push data into the MonitoredItem at faster rates (source may need to do this if many MonitoredItems are requesting the same data that is only sampled once).</p>
<h1><a class="anchor" id="L3ServerSdkServerManServerInternalClient"></a>
ServerInternalClient</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html">ServerInternalClient</a> is a class that provides all for the basic UA services such as <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#ada3aa50f143933aeff135cd16a278270">Read</a>, <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a3f69132614d425c7cc070e7049213983">Write</a>, <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a45aa41c221704ceafe842229f27dcc33">Call</a> and Subscribe to clients within the process. These services are useful when NodeManagers need to get information from other NodeManagers. This could also be used to implement a historian that collects data from real time data managed by other NodeManagers.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerSdkOverview.html">Server SDK Overview</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
