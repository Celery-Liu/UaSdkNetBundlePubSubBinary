<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: History Read – History Read Raw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ClientTutExample14.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">History Read – History Read Raw </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ClientTutExample14Pre">Prerequisites</a></li>
<li class="level1"><a href="#L4ClientTutExample14Desc">Description</a></li>
<li class="level1"><a href="#L4ClientTutExample14Code">Sample Code</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L4ClientTutExample14Pre"></a>
Prerequisites</h1>
<p>A session with the server must be established.</p>
<h1><a class="anchor" id="L4ClientTutExample14Desc"></a>
Description</h1>
<p>The following dialog shows an example implementation of the History Read service. Press the button “Show Code” to display the corresponding code, and the button “Help” to show this documentation page.</p>
<div class="image">
<img src="clienttutorials_history_read_raw.png" alt="clienttutorials_history_read_raw.png"/>
</div>
<p>Press the button “...” right of the field “Variable” to open a window to browse the address space and select a historizing variable. After pressing the button “OK” the NodeId will be shown in the corresponding field.</p>
<div class="image">
<img src="clienttutorials_read_attribute2.png" alt="clienttutorials_read_attribute2.png"/>
</div>
<p>You can specify a time range by checking the boxes right of the input fields “Start Time” and “End Time” and entering the desired values. Clicking on the arrow in the input field opens a calendar for picking the date. The time can be entered directly.</p>
<div class="image">
<img src="clienttutorials_history_read_raw2.png" alt="clienttutorials_history_read_raw2.png"/>
</div>
<p>In addtion you can specify the maximum number of values to be returned in the field “Num Values” and include the bounding values specified above by checking the box right of “Include Bounds”.</p>
<p>On pressing the button “Read History” the response is listed at “History Read Response”. Check the box in front of “Use Asynchronous Pattern” to call “BeginHistoryRead” instead of “HistoryRead”.</p>
<div class="image">
<img src="clienttutorials_history_read_raw3.png" alt="clienttutorials_history_read_raw3.png"/>
</div>
<p>If a maximum number of values is specified above, a continuation point is set. Pressing the button “Read History” again returns values starting at that continuation point. After pressing the button “Releasse Continuation Point” returned values are starting at the start time specified above.</p>
<h1><a class="anchor" id="L4ClientTutExample14Code"></a>
Sample Code</h1>
<p>The following code reads the historical data for a variable in a specified time range and displays the result in a list.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaClient_1_1Session.html">UaClient.Session</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaClient_1_1Session.html#a6418ff968d022825449895d9439ac107">UaClient.Session.HistoryReadRaw</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ReadRawModifiedDetails.html">UaBase.ReadRawModifiedDetails</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1HistoryReadValueId.html">UaBase.HistoryReadValueId</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaClient_1_1RequestSettings.html">UaClient.RequestSettings</a></li>
</ul>
<div class="fragment"><div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// get the current session from the parent form.</span></div>
<div class="line">                Session session = m_parent.Session;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// nothing to do if no session.</span></div>
<div class="line">                <span class="keywordflow">if</span> (session == null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// parse the object id.</span></div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a4b5bd8a54893c87287a22228b5ef2bc8">NodeId</a> nodeId = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a4b5bd8a54893c87287a22228b5ef2bc8">NodeId</a>.Parse(NodeIdTB.Text);</div>
<div class="line"></div>
<div class="line">                ReadRawModifiedDetails details = m_details as ReadRawModifiedDetails;</div>
<div class="line">                HistoryReadValueIdCollection nodesToRead = <span class="keyword">new</span> HistoryReadValueIdCollection();</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (m_nodeToContinue == null)</div>
<div class="line">                {</div>
<div class="line">                    m_dataset.Tables[0].Rows.Clear();</div>
<div class="line"></div>
<div class="line">                    details = <span class="keyword">new</span> ReadRawModifiedDetails();</div>
<div class="line">                    details.StartTime = (StartTimeCK.Checked) ? StartTimeDP.Value.ToUniversalTime() : <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.MinValue;</div>
<div class="line">                    details.EndTime = (EndTimeCK.Checked) ? EndTimeDP.Value.ToUniversalTime() : <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.MinValue;</div>
<div class="line">                    details.NumValuesPerNode = (MaxReturnValuesCK.Checked) ? (uint)MaxReturnValuesNP.Value : 0;</div>
<div class="line">                    details.IsReadModified = <span class="keyword">false</span>;</div>
<div class="line">                    details.ReturnBounds = ReturnBoundsCK.Checked;</div>
<div class="line"></div>
<div class="line">                    nodesToRead.Add(<span class="keyword">new</span> HistoryReadValueId() { <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a4b5bd8a54893c87287a22228b5ef2bc8">NodeId</a> = nodeId });</div>
<div class="line"></div>
<div class="line">                    m_details = details;</div>
<div class="line">                    m_nodeToContinue = nodesToRead[0];</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    nodesToRead.Add(m_nodeToContinue);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// this is a blocking call so show the wait cursor.</span></div>
<div class="line">                Cursor = Cursors.WaitCursor;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// fetch the history (with a 10s timeout).</span></div>
<div class="line">                List&lt;HistoryDataReadResult&gt; results = session.HistoryReadRaw(</div>
<div class="line">                    nodesToRead,</div>
<div class="line">                    details,</div>
<div class="line">                    <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a786f7446cd520df161222ac779c2caa9">TimestampsToReturn</a>.Source,</div>
<div class="line">                    <span class="keyword">new</span> RequestSettings() { OperationTimeout = 10000 });</div>
<div class="line"></div>
<div class="line">                <span class="comment">// check for operation error.</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a>.IsBad(results[0].StatusCode))</div>
<div class="line">                {</div>
<div class="line">                    m_parent.ShowError(<span class="keyword">this</span>, <span class="stringliteral">&quot;Read history call failed: &quot;</span> + results[0].<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a>.ToString());</div>
<div class="line">                    m_details = null;</div>
<div class="line">                    m_nodeToContinue = null;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// update controls.</span></div>
<div class="line">                <span class="keywordflow">if</span> (results[0].DataValues != null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">foreach</span> (DataValue value <span class="keywordflow">in</span> results[0].DataValues)</div>
<div class="line">                    {</div>
<div class="line">                        AddValue(value, null);</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    m_dataset.AcceptChanges();</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// save continuation point.</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a58efa9e8b8491c4a42cbf3bead1b06b6">ByteString</a>.IsNull(results[0].ContinuationPoint))</div>
<div class="line">                {</div>
<div class="line">                    m_nodeToContinue.ContinuationPoint = results[0].ContinuationPoint;</div>
<div class="line">                    ReleaseContinuationPointBTN.Visible = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    m_nodeToContinue = null;</div>
<div class="line">                    ReleaseContinuationPointBTN.Visible = <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (Exception exception)</div>
<div class="line">            {</div>
<div class="line">                ExceptionDlg.ShowInnerException(this.Text, exception);</div>
<div class="line">                m_nodeToContinue = null;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">finally</span></div>
<div class="line">            {</div>
<div class="line">                Cursor = Cursors.Default;</div>
<div class="line">            }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ClientTutorials.html">Tutorials for Client development</a></li><li class="navelem"><a class="el" href="L2ClientTutExamples.html">Getting Started</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
