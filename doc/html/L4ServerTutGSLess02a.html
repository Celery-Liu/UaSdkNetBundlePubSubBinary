<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Using UaModeler for Model Design and Code Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L4ServerTutGSLess02a.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using UaModeler for Model Design and Code Generation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ServerTutGSLess02aStep01">Generating a New Project in UaModeler</a></li>
<li class="level1"><a href="#L4ServerTutGSLess02aStep02">Adding ControllerType</a></li>
<li class="level1"><a href="#L4ServerTutGSLess02aStep03">Adding Controller Subtypes</a></li>
<li class="level1"><a href="#L4ServerTutGSLess02aStep04">Export Model as XML File and Generate Code</a></li>
<li class="level1"><a href="#L4ServerTutGSLess02aStep05">Integrating the Model into an Empty Server</a></li>
</ul>
</div>
<div class="textblock"><p>This section contains information on how to use UaModeler for generating the information model used in the Getting Started lessons. Please refer to the documentation of UaModeler for more detailed information on using this tool.</p>
<h1><a class="anchor" id="L4ServerTutGSLess02aStep01"></a>
Generating a New Project in UaModeler</h1>
<p>First, we have to create the model shown in the <a class="el" href="L4ServerTutGSLess02Intro.html">Introduction</a> in UaModeler.</p>
<p>Select File → New Project from the menu bar to start the New Project Wizard.</p>
<p>At “General Project Settings” enter the Project Name as shown in the screenshot below. At “Location” choose a directory for storing the project files. Confirm with “Next”.</p>
<div class="image">
<img src="serverlesson02a_st1_new_project.png" alt="serverlesson02a_st1_new_project.png"/>
<div class="caption">
Figure 2.4: General Project Settings Dialog</div></div>
<p> The “Generate Code” dialog will appear. At “Template Set”, select the .NET Server Templates. In addition, you have to specify an output directory for the generated code.</p>
<div class="image">
<img src="serverlesson02a_st1_new_project2.png" alt="serverlesson02a_st1_new_project2.png"/>
<div class="caption">
Figure 2.5: Generate Code Dialog</div></div>
<p> At the “Choose Base Models“ dialog, continue with default settings.</p>
<p>The new “New Model” dialog window will appear. Fill out the input fields as shown in the screenshot and finish the wizard.</p>
<div class="image">
<img src="serverlesson02a_st1_new_project3.png" alt="serverlesson02a_st1_new_project3.png"/>
<div class="caption">
Figure 2.6: New Model Dialog</div></div>
 <h1><a class="anchor" id="L4ServerTutGSLess02aStep02"></a>
Adding ControllerType</h1>
<p>Browse to Types → ObjectTypes → BaseObjectType and add a subtype to BaseObjectType by pressing the button “AddSubtype” or by choosing “Add New Type” from the context menu. Enter the name “ControllerType” at “Type” and confirm with OK. The newly created Type should now show up in the Information Model window beneath BaseObjectType.</p>
<p><a class="anchor" id="fig_serverlesson02aSt2_add_controllertype"></a></p><div class="image">
<img src="serverlesson02a_st2_add_controllertype.png" alt="serverlesson02a_st2_add_controllertype.png"/>
<div class="caption">
Figure 2.7: Adding ControllerType</div></div>
<p> Expand the input field at “Children” and add the Variables and Methods shown in <a class="el" href="L4ServerTutGSLess02Intro.html#fig_serverlesson02_controller_obj_type">Figure 2.2</a>.</p>
<p><a class="anchor" id="fig_serverlesson02aSt2_add_controllertype2"></a></p><div class="image">
<img src="serverlesson02a_st2_add_controllertype2.png" alt="serverlesson02a_st2_add_controllertype2.png"/>
<div class="caption">
Figure 2.8: Adding Variables and Methods</div></div>
<h1><a class="anchor" id="L4ServerTutGSLess02aStep03"></a>
Adding Controller Subtypes</h1>
<p>As a next step, add <em>AirConditionerControllerType</em> and <em>FurnaceControllerType</em> as Subtypes of <em>ControllerType</em> as shown in <a class="el" href="L4ServerTutGSLess02Intro.html#fig_serverlesson02_controller_obj_subtypes">Figure 2.3</a>, including Variables and Methods. To add input arguments, expand the method in the input field “Children” as shown in the following figure.</p>
<div class="image">
<img src="serverlesson02a_st3_add_controllersubtype.png" alt="serverlesson02a_st3_add_controllersubtype.png"/>
<div class="caption">
Figure 2.9: Adding Subtypes of ControllerType</div></div>
<p> Finally, add <em>ControllerEventType</em> as Subtype of <em>BaseEventType</em>, containing the children <em>Temperature</em> and <em>State</em>.</p>
<p>The complete infomation model is shown in Figure 2.10.</p>
<div class="image">
<img src="serverlesson02a_st3_add_types_and_components.png" alt="serverlesson02a_st3_add_types_and_components.png"/>
<div class="caption">
Figure 2.10: Types and Components</div></div>
 <h1><a class="anchor" id="L4ServerTutGSLess02aStep04"></a>
Export Model as XML File and Generate Code</h1>
<p>To export the previously created model, select “Export XML” from the model’s context menu in the Project Window as shown in the following screenshot.</p>
<div class="image">
<img src="serverlesson02a_st4_export_model.png" alt="serverlesson02a_st4_export_model.png"/>
<div class="caption">
Figure 2.11: Export model as XML</div></div>
<p> Finally, we generate source files by pressing the “Compile” button (the blue gear-wheel) in the menu bar. The model XML file (buildingautomation.xml) can be found in the project folder, the generated source code file (BAIdentifiers.cs) is located in the output directory specified above.</p>
<h1><a class="anchor" id="L4ServerTutGSLess02aStep05"></a>
Integrating the Model into an Empty Server</h1>
<p>We are using the basic OPC UA server from Lesson 1 as a starting point. The prepared sample code can be found in the Lesson 2 project of the UA Server Getting Started solution.</p>
<p>At first, we have to add the file containing the model (buildingautomation.xml) to the Visual Studio project (Add → Existing Item). Choose “Properties” from the context menu and set “Build Action” to “Embedded Resource” as shown in the following screenshot.</p>
<div class="image">
<img src="serverlesson02a_st5_add_model.png" alt="serverlesson02a_st5_add_model.png"/>
<div class="caption">
Figure 2.12: Add buildingautomation.xml as Embedded Resource</div></div>
<p> Then, we have to load the model in Lesson02Nodemanager.cs</p>
 <div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="namespaceSystem.html">System</a>.Reflection;</div>
</div><!-- fragment --></p>
<p><div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Startup()</div>
<div class="line">        {</div>
</div><!-- fragment --> </p><div class="fragment"><div class="line">...</div>
</div><!-- fragment --> <div class="fragment"><div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Loading the Controller Model.&quot;</span>);</div>
<div class="line">                ImportUaNodeset(Assembly.GetEntryAssembly(), <span class="stringliteral">&quot;buildingautomation.xml&quot;</span>);</div>
</div><!-- fragment --><p> Now we are ready to compile and start-up the server.</p>
<p>When connecting to the server with an OPC UA client, e.g. UaExpert, we will notice that the type nodes are already visible in the server’s address space (see Figure 2.13).</p>
<div class="image">
<img src="serverlesson02a_st5_expert.png" alt="serverlesson02a_st5_expert.png"/>
<div class="caption">
Figure 2.13: Type nodes in the server’s address space</div></div>
<p> Next step: <a class="el" href="L4ServerTutGSLess02Step06.html">Preparing Instance Creation</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutGettingStarted.html">Getting Started</a></li><li class="navelem"><a class="el" href="L3ServerTutGSLess02.html">Lesson 2: Extending the Address Space with Real World Data</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
