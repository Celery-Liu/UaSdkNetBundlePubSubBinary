<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Implementing Security</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L2BaseLibSecurity.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Implementing Security </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L3BaseLibSecurityOverview">Overview</a></li>
<li class="level1"><a href="#L3BaseLibSecuritySetUpApplication">Set up Application</a></li>
<li class="level1"><a href="#L3BaseLibSecurityConfigureSecurity">Configure Security</a></li>
<li class="level1"><a href="#L3BaseLibSecurityCertificateStores">Certificate Stores</a><ul><li class="level2"><a href="#L3BaseLibSecurityConfigureCertificateStores">Configure Certificate Stores</a></li>
</ul>
</li>
<li class="level1"><a href="#L3BaseLibSecurityAddCertificate">Add Certificate</a></li>
<li class="level1"><a href="#L3BaseLibSecurityStartUp">StartUp</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L3BaseLibSecurityOverview"></a>
Overview</h1>
<p>OPC UA requires a bidirectional authentication of the Client and Server applications with X.509 application instance certificates during the establishment of a secure communication connection. Application instance certificates are required to uniquely identify each installation or instance of an application. The Server application provides its application instance certificate via the Discovery Service Set. The Client provides its application instance certificate in the OpenSecureChannel Service. See <a class="el" href="L2UaDiscoveryConnect.html">Certificates, Certificate Store and Trust List</a> in the general OPC UA introduction for background information regarding certificate management</p>
<p>To set up an .Net OPC Ua Server or Client with security, the following points should be mentioned:</p>
<ul>
<li><a class="el" href="L2BaseLibSecurity.html#L3BaseLibSecuritySetUpApplication">Set up Application</a></li>
<li><a class="el" href="L2BaseLibSecurity.html#L3BaseLibSecurityConfigureSecurity">Configure Security</a></li>
<li><a class="el" href="L2BaseLibSecurity.html#L3BaseLibSecurityAddCertificate">Add Certificate</a></li>
<li><a class="el" href="L2BaseLibSecurity.html#L3BaseLibSecurityStartUp">StartUp</a></li>
</ul>
<h1><a class="anchor" id="L3BaseLibSecuritySetUpApplication"></a>
Set up Application</h1>
<p>To add security features to an .Net OPC Application, set a SecurityProvider at the application. The SecurityProvider is capable for all security aspects in the SDK. The SDK provides two implementations of the <a class="el" href="interfaceUnifiedAutomation_1_1UaBase_1_1ISecurityProvider.html">SecurityProvider Interface</a> to choose from:</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1WindowsSecurityProvider.html">WindowsSecurityProvider</a> in UaBase.Windows using Opc.Ua.CertificateGenerator.exe</li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1BouncyCastleSecurityProvider.html">BouncyCastleSecurityProvider</a> in UaBase.BouncyCastle using the external package BouncyCastle</li>
</ul>
<ol type="1">
<li>Use the provided NugetPackages to add the preferred libraries to the application.</li>
<li>Set a new SecurityProvider before start at the used <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html">ApplicationInstanceBase</a> or <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstance.html">ApplicationInstance</a>.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>The <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstance.html">ApplicationInstance</a> from UaBase.Windows already has the WindowsSecurityProvider attached by default.</dd></dl>
<p>If using the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1WindowsSecurityProvider.html">WindowsSecurityProvider</a> copy the Opc.Ua.CertificateGenerator.exe into the root directory of the application.</p>
<dl class="section note"><dt>Note</dt><dd>The Opc.Ua.CertificateGenerator.exe can be found in the <b>bin</b> directory of the SDK installation.</dd></dl>
<h1><a class="anchor" id="L3BaseLibSecurityConfigureSecurity"></a>
Configure Security</h1>
<p>To enable secure communication, the application should be configured properly.</p>
<h3>Mandatory configurations:</h3>
<ul>
<li>Certificate Stores</li>
<li>SubjectName</li>
<li>Supported Security Profiles</li>
</ul>
<h3>Optional configurations:</h3>
<ul>
<li>Endpoint Configuration</li>
</ul>
<h1><a class="anchor" id="L3BaseLibSecurityCertificateStores"></a>
Certificate Stores</h1>
<p>There are two types of stores supported by the SDK:</p>
<ul>
<li><h3>Directory:</h3>
</li>
</ul>
<p>Store that is based on the environmental folder structure of your server host system. Certificates will be stored as .DER (Public Key) and .PFX (Private Key) file types. The SDK will create additional sub folders in the leaf of the configured store paths.</p>
<p>Directory Store is supported by Windows and Linux systems.</p>
<ul>
<li><h3>Windows:</h3>
</li>
</ul>
<p>Store that uses the Windows Certificate Store implementation. Certificates will be stored and managed by the Windows environment. The SDK can add Certificates to the Windows store, the following root store paths are supported:</p>
<ul>
<li>LocalMachine</li>
<li>CurrentUser</li>
<li>Service</li>
<li>User</li>
</ul>
<p>Windows Store is only supported by Windows systems by using the UaBase.Windows assembly.</p>
<h2><a class="anchor" id="L3BaseLibSecurityConfigureCertificateStores"></a>
Configure Certificate Stores</h2>
<p>Stores will be configured though the provided <a class="el" href="L2BaseLibConfigOptions.html">Configuration Methods</a>.</p>
<p>For secured communication the following stores have to be configured:</p>
<h3>Mandatory Stores:</h3>
<ul>
<li>ApplicationCertificate (own)</li>
<li>TrustedCertificateStore</li>
<li>IssuerCertificateStore</li>
</ul>
<h3>Optional Stores:</h3>
<ul>
<li>RejectedCertificatesStore</li>
</ul>
<p>For a file based configuration like app.config, add and fill the following properties for each store to add:</p>
<div class="fragment"><div class="line">&lt;ApplicationCertificate&gt;           --&gt; Store name</div>
<div class="line">  &lt;StoreType&gt;Directory&lt;/StoreType&gt; --&gt; configured \ref L3BaseLibSecurityCertificateStores <span class="stringliteral">&quot;store type&quot;</span>.</div>
<div class="line">  &lt;StorePath&gt;&lt;/StorePath&gt;          --&gt; relative or absolute path to the store.</div>
<div class="line">  &lt;SubjectName&gt;&lt;/SubjectName&gt;      --&gt; The SubjectName of the <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfae498749f3c42246d50b15c81c101d988">Application</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#af559c045bfc95472b62792ce00f0d6a5aeb0f48a107df1a0f343d4cd513b555e6">Certificate</a> that should be loaded at startup. Only necessary <span class="keywordflow">for</span> ApplicationCertificate.</div>
<div class="line">  &lt;Thumbprint&gt;&lt;/Thumbprint&gt;        --&gt; The Thumbprint of the <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfae498749f3c42246d50b15c81c101d988">Application</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#af559c045bfc95472b62792ce00f0d6a5aeb0f48a107df1a0f343d4cd513b555e6">Certificate</a> that should be loaded at startup. Only necessary <span class="keywordflow">for</span> ApplicationCertificate.</div>
<div class="line">&lt;/ApplicationCertificate&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For using Windows Store, replace the StoreType with 'Windows' and set valid Windows store paths. Mixed configurations are also possible.</dd></dl>
<p>For <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html">ConfigurationInMemory</a> set a new UnifiedAutomation.UaSchema.CertificateIdentifier for the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html#a4b02f94930141eba3de8b459db5d0a33">ApplicationCertificate</a>, as well as UnifiedAutomation.UaSchema.CertificateStoreIdentifier´s for</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html#a1d4faec1825442e7beb7167ec0137bb7">TrustedCertificateStore</a>,</li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html#a8f8eab791b93d1ff5ac75c1748b976d3">IssuerCertificateStore</a>,</li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html#a8a515672916905ec5d01fa6f7d124079">RejectedCertificatesStore</a></li>
</ul>
<p>For a quick setup, use the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ConfigurationInMemory.html#afa47ff25f4ecbe56cbf1a52d8bff204a">SetSecurity</a> method to add all necessary stores as Directory Store to your application.</p>
<h1><a class="anchor" id="L3BaseLibSecurityAddCertificate"></a>
Add Certificate</h1>
<p>If security is configured, the SDK tries to load a certificate at startup. It proceeds in the following order:</p>
<ol type="1">
<li>Load certificate from configured ApplicationCertificate Store by SubjectName or Thumbprint.</li>
<li>Add a Certificate by the application through the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a7b230f2e37e2ccb0d005b3c699fdeb0f">CertificateNotFound</a> EventHandler.</li>
<li>Instruct the SDK to generate a self signed Certificate by setting <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a41b1d36ba1457f2b00a3a5be7ad55bd7">AutoCreateCertificate</a> to <code>true</code>.</li>
</ol>
<h1><a class="anchor" id="L3BaseLibSecurityStartUp"></a>
StartUp</h1>
<dl class="section attention"><dt>Attention</dt><dd>Since SDK version 4.0 the startup behavior changed.</dd></dl>
<p>When starting an .Net UaServer with configured security, a certificate is mandatory. Otherwise the server will <b>not start</b>. If no certificate could be found in the configured stores, the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a7b230f2e37e2ccb0d005b3c699fdeb0f">CertificateNotFound</a> EventHandler will be called. This allows to inform the application about a missing certificate or to load one from the application. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1BaseLibOverview.html">Base Library Overview</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
