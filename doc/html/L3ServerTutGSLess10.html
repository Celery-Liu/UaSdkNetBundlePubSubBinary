<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Lesson 10: GDS Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ServerTutGSLess10.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Lesson 10: GDS Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#serverlesson10_ov">Overview</a></li>
<li class="level1"><a href="#serverlesson10_push">Push Management</a><ul><li class="level2"><a href="#serverlesson10_push_configure_securityadmin">Configure SecurityAdmin</a></li>
<li class="level2"><a href="#serverlesson10_push_register_configtool">Register Server with GDS Configuration Tool</a></li>
<li class="level2"><a href="#serverlesson10_push_register_self">Self Registration</a></li>
</ul>
</li>
<li class="level1"><a href="#serverlesson10_pull">Pull Management</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="serverlesson10_ov"></a>
Overview</h1>
<p>This example shows how to register the server application at a Global Discovery Server (GDS) and receive and use a signed certificate and a trust list managed by the GDS.</p>
<p>When implementing the Push Management, the GDS will be responsible for updating the server certificate and trust list. When implementing the Pull Management, the server itself is responsible for getting the certificate and the trust list from the GDS.</p>
<dl class="section attention"><dt>Attention</dt><dd>The application instance certificate of the GDS must get accepted by the server application.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>A running Global Discovery Server must be available. This tutorial shows the usage of UaGDS (<a href="https://www.unified-automation.com/products/ua-runtime-software/uagds.html">https://www.unified-automation.com/products/ua-runtime-software/uagds.html</a>).</dd></dl>
<h1><a class="anchor" id="serverlesson10_push"></a>
Push Management</h1>
<h2><a class="anchor" id="serverlesson10_push_configure_securityadmin"></a>
Configure SecurityAdmin</h2>
<p>The GDS application must be elevated as SecurityAdmin to be able to push a certificate or a trust list to the server. The Role assignment to a specific user or the GDS application shall be configured in the RoleConfiguration file.</p>
<p>When specifying a user, the user credentials must be known by the GDS. The credentials can be set in the GDS Configuration Tool. Alternatively the Role SecurityAdmin can be assigned to GDS application. In this case the server ApplicationUri of the GDS must be known on server side.</p>
<div class="fragment"><div class="line">&lt;<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfabbbabdbe1b262f75d99d62880b953be1">Role</a> Name=<span class="stringliteral">&quot;SecurityAdmin&quot;</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a4b5bd8a54893c87287a22228b5ef2bc8">NodeId</a>=<span class="stringliteral">&quot;i=15704&quot;</span>&gt;</div>
<div class="line">  &lt;Identities&gt;</div>
<div class="line">    &lt;Identity CriteriaType=<span class="stringliteral">&quot;UserName&quot;</span>&gt;joe&lt;/Identity&gt;</div>
<div class="line">    &lt;Identity CriteriaType=<span class="stringliteral">&quot;Application&quot;</span>&gt;APPLICATIONURI_OF_GDS&lt;/Identity&gt;</div>
<div class="line">  &lt;/Identities&gt;</div>
<div class="line">&lt;/<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfabbbabdbe1b262f75d99d62880b953be1">Role</a>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="serverlesson10_push_register_configtool"></a>
Register Server with GDS Configuration Tool</h2>
<p>The Push Configuring the servers is described in the <a href="https://documentation.unified-automation.com/uagds/1.0.0/html/sec_config_push.html">documentation of the GDS</a>.</p>
<p>The data entered in "Step 3: Configure Push" is dependent on the role configuration. If the GDS application gets the SecurityAdmin Role by its ApplicationUri, the Authentication Settings can be set to Anonymous.</p>
<h2><a class="anchor" id="serverlesson10_push_register_self"></a>
Self Registration</h2>
<p>The server application can register itself at the GDS using the class <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1GdsRegisterManagement.html">GdsRegisterManagement</a>. An instance of this class shall be set at <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a19fc5178fba9c486352441cada28eced">ApplicationInstanceBase.GdsHandler</a> before the application has been started. Additionally the EndpointUrl of the GDS has to be set in the application settings of the server application.</p>
<p>The class GdsRegisterManagement has several EventHandlers that can be implemented by the application.</p>
<div class="fragment"><div class="line">                var gdsHandler = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation.html">UnifiedAutomation</a>.<a class="code" href="namespaceUnifiedAutomation_1_1UaClient.html">UaClient</a>.<a class="code" href="classUnifiedAutomation_1_1UaClient_1_1GdsRegisterManagement.html">GdsRegisterManagement</a>(application);</div>
<div class="line">                gdsHandler.<a class="code" href="classUnifiedAutomation_1_1UaClient_1_1GdsRegisterManagement.html#a9a4ad77eb6ec7f43ab600302d96df8e8">ApplicationRegistered</a> += (s, e) =&gt;</div>
<div class="line">                {</div>
<div class="line">                    Console.WriteLine($<span class="stringliteral">&quot;Application registered at GDS. ApplicationId {e.ApplicationId}, Mode {e.RegisteredApplicationMode}.&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Check if registration must be accepted in GDS Configuration Tool and GDS Model shall be changed to \&quot;Push Model\&quot;.&quot;</span>);</div>
<div class="line">                };</div>
<div class="line">                application.GdsHandler = gdsHandler;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">&lt;Extension&gt;</div>
<div class="line">  &lt;GdsSettings xmlns=<span class="stringliteral">&quot;http://unifiedautomation.com/schemas/2011/12/Application.xsd&quot;</span>&gt;</div>
<div class="line">    &lt;GdsDiscoveryUrl&gt;opc.tcp:<span class="comment">//localhost:48060&lt;/GdsDiscoveryUrl&gt;</span></div>
<div class="line">  &lt;/GdsSettings&gt;</div>
<div class="line">&lt;/Extension&gt;</div>
</div><!-- fragment --><p>After the server has been started for the first time, the server application will be visible in the Pending List in the GDS Configuration Tool. After accepting the registration the GDS Model can be changed to "Push Model".</p>
<div class="image">
<img src="serverlesson10_pendinglist.png" alt="serverlesson10_pendinglist.png"/>
<div class="caption">
Accept application in pending list for application registration</div></div>
 <div class="image">
<img src="serverlesson10_configurepush.png" alt="serverlesson10_configurepush.png"/>
<div class="caption">
Change Gds Model to Push Model</div></div>
 <dl class="section note"><dt>Note</dt><dd>The class GdsRegisterManagement is implemented in <a class="el" href="namespaceUnifiedAutomation_1_1UaClient.html">UnifiedAutomation.UaClient</a>. So you need to add this NuGet package to your VS project.</dd></dl>
<h1><a class="anchor" id="serverlesson10_pull"></a>
Pull Management</h1>
<p>The server application can register itself at the GDS and do the complete GDS handling itself using the class <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1GdsPullManagement.html">GdsPullManagement</a>. An instance of this class shall be set at <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a19fc5178fba9c486352441cada28eced">ApplicationInstanceBase.GdsHandler</a> before the application has been started. Additionally the EndpointUrl of the GDS has to be set in the application settings of the server application.</p>
<p>The class GdsPullManagement has several EventHandlers that can be implemented by the application.</p>
<div class="fragment"><div class="line">                var gdsHandler = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation.html">UnifiedAutomation</a>.<a class="code" href="namespaceUnifiedAutomation_1_1UaClient.html">UaClient</a>.<a class="code" href="classUnifiedAutomation_1_1UaClient_1_1GdsPullManagement.html">GdsPullManagement</a>(application);</div>
<div class="line">                gdsHandler.<a class="code" href="classUnifiedAutomation_1_1UaClient_1_1GdsPullManagement.html#a1cea2fa65c79c89af90e7bc2bbec923c">NewCertificate</a> += (s, e) =&gt;</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// The new certificate will be used by the server after the transport listeners have been re-initialized.</span></div>
<div class="line">                    server.RestartTransportListeners();</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Certificate signed by GDS assigned. Restarting server.&quot;</span>);</div>
<div class="line">                };</div>
<div class="line">                gdsHandler.ApplicationRegistered += (s, e) =&gt;</div>
<div class="line">                {</div>
<div class="line">                    Console.WriteLine($<span class="stringliteral">&quot;Application registered at GDS. ApplicationId {e.ApplicationId}, Mode {e.RegisteredApplicationMode}&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Check if registration must be accepted in GDS Configuration Tool.&quot;</span>);</div>
<div class="line">                };</div>
<div class="line">                gdsHandler.SignCertificateFailed += (s, e) =&gt; { Console.WriteLine($<span class="stringliteral">&quot;Sign certificate failed with message {e.Exception}.&quot;</span>); };</div>
<div class="line">                gdsHandler.TrustListUpdated += (s, e) =&gt; { Console.WriteLine(<span class="stringliteral">&quot;TrustList updated&quot;</span>); };</div>
<div class="line">                application.GdsHandler = gdsHandler;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">&lt;Extension&gt;</div>
<div class="line">  &lt;GdsSettings xmlns=<span class="stringliteral">&quot;http://unifiedautomation.com/schemas/2011/12/Application.xsd&quot;</span>&gt;</div>
<div class="line">    &lt;GdsDiscoveryUrl&gt;opc.tcp:<span class="comment">//localhost:48060&lt;/GdsDiscoveryUrl&gt;</span></div>
<div class="line">  &lt;/GdsSettings&gt;</div>
<div class="line">&lt;/Extension&gt;</div>
</div><!-- fragment --><p>After the server has been started for the first time, the server application will be visible in the Pending Lists for applications to register and certificate signing requests in the GDS Configuration Tool. After accepting both, the server will receive a new certificate and trust list.</p>
<dl class="section note"><dt>Note</dt><dd>If the server gets a new certificate from the GDS its endpoints have to re-initialized. This can be implemented with the <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1GdsPullManagement.html#a1cea2fa65c79c89af90e7bc2bbec923c">NewCertificate</a> EventHandler.</dd></dl>
<div class="image">
<img src="serverlesson10_pendinglist.png" alt="serverlesson10_pendinglist.png"/>
<div class="caption">
Accept application in pending list for application registration</div></div>
 <div class="image">
<img src="serverlesson10_pendinglist2.png" alt="serverlesson10_pendinglist2.png"/>
<div class="caption">
Accept application in pending list for certificate signing requests</div></div>
 <dl class="section note"><dt>Note</dt><dd>The class GdsPullManagement is implemented in <a class="el" href="namespaceUnifiedAutomation_1_1UaClient.html">UnifiedAutomation.UaClient</a>. So you need to add this NuGet package to your VS project. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutGettingStarted.html">Getting Started</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
