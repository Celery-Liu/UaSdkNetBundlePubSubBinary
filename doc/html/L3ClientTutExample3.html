<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Certificate Management – Create Certificate</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ClientTutExample3.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Certificate Management – Create Certificate </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ClientTutExample3Desc">Description</a></li>
<li class="level1"><a href="#L4ClientTutExample3Code">Sample Code</a><ul><li class="level2"><a href="#L4ClientTutExample3Code_st01">Step 1: Tell the SDK to Automatically Create Certificates</a></li>
<li class="level2"><a href="#L4ClientTutExample3Code_st02">Step 2: Implement the CertificateNotFound Callback</a></li>
<li class="level2"><a href="#L4ClientTutExample3Code_st03">Step 3: CreateCertificateDialog</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L4ClientTutExample3Desc"></a>
Description</h1>
<p>The following screenshot shows an example dialog for creating a new certificate. Press the button “Show Code” to display the corresponding code, and the button “Help” to show this documentation page.</p>
<div class="image">
<img src="clienttutorials_create_certificate.png" alt="clienttutorials_create_certificate.png"/>
</div>
<p>This dialog is used in the .NET based OPC UA Demo Server and the Getting Started Client Example included in the SDK. On first start-up, the application checks for a certificate. If no certificate exists, the dialog for creating a new certificate shows up.</p>
<p>The input fields are filled with default values which can be changed to the user’s liking. On clicking the “Advanced” button, additional input fields show up, which can be hidden again by pressing the “Basic” button.</p>
<div class="image">
<img src="clienttutorials_create_certificate2.png" alt="clienttutorials_create_certificate2.png"/>
</div>
<p>Clicking on “Create” stores the certificate, by clicking “Cancel” the process can be aborted.</p>
<h1><a class="anchor" id="L4ClientTutExample3Code"></a>
Sample Code</h1>
<h2><a class="anchor" id="L4ClientTutExample3Code_st01"></a>
Step 1: Tell the SDK to Automatically Create Certificates</h2>
<p>Setting the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a41b1d36ba1457f2b00a3a5be7ad55bd7">AutoCreateCertificate</a> to true tells the SDK to create a certificate automatically at startup, if none could be loaded from the configured certificate store.</p>
<div class="fragment"><div class="line">                ApplicationInstance.Default.AutoCreateCertificate = <span class="keyword">true</span>;</div>
</div><!-- fragment --><p> The <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a7b230f2e37e2ccb0d005b3c699fdeb0f">CertificateNotFound</a> is the event that is raised when the SDK detects that no certificate could be loaded from the store. This allows to notify the application, or allow the application to customize the creation of the certificate.</p>
<div class="fragment"><div class="line">                ApplicationInstance.Default.CertificateNotFound += <span class="keyword">new</span> EventHandler&lt;CreateCertificateEventArgs&gt;(Application_CertificateNotFound);</div>
</div><!-- fragment --> <h2><a class="anchor" id="L4ClientTutExample3Code_st02"></a>
Step 2: Implement the CertificateNotFound Callback</h2>
<div class="fragment"><div class="line">        <span class="keyword">static</span> <span class="keyword">private</span> <span class="keywordtype">void</span> Application_CertificateNotFound(<span class="keywordtype">object</span> sender, CreateCertificateEventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// let the application create a suitable default if no user interaction allowed.</span></div>
<div class="line">                <span class="keywordflow">if</span> (e.Silent)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                CreateCertificateDialog dialog = <span class="keyword">new</span> CreateCertificateDialog();</div>
<div class="line"></div>
<div class="line">                ICertificate certificate = dialog.ShowDialog(null, <span class="keyword">new</span> CreateCertificateDialogSettings()</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfae498749f3c42246d50b15c81c101d988">Application</a> = e.Application,</div>
<div class="line">                    Instructions = <span class="stringliteral">&quot;The application does not have a certificate assigned.\r\nPlease specify the parameters for a new certificate.&quot;</span></div>
<div class="line">                });</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (certificate != null)</div>
<div class="line">                {</div>
<div class="line">                    e.NewCertificate = certificate;</div>
<div class="line">                    e.UpdateConfiguration = dialog.PersistConfiguration;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (Exception exception)</div>
<div class="line">            {</div>
<div class="line">                ExceptionDlg.ShowInnerException(<span class="stringliteral">&quot;&quot;</span>, exception);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">private</span> <span class="keywordtype">void</span> Application_ConfigurationChanged(<span class="keywordtype">object</span> sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                ApplicationInstance.Default.SaveConfiguration(<span class="keyword">false</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (Exception exception)</div>
<div class="line">            {</div>
<div class="line">                ExceptionDlg.ShowInnerException(<span class="stringliteral">&quot;&quot;</span>, exception);</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><h2><a class="anchor" id="L4ClientTutExample3Code_st03"></a>
Step 3: CreateCertificateDialog</h2>
<p>The CreateCertificateDialog displays the fields of the certificate and allows the user to change them. A certificate issued by a Certificate Authority (CA) can be created by specifying an issuer certificate. The certificate settings can be found here: <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1CreateCertificateSettings.html">CreateCertificateSettings</a>.</p>
<p>The “Persist Configuration” check box is only evaluated if the dialog is opened by the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ApplicationInstanceBase.html#a7b230f2e37e2ccb0d005b3c699fdeb0f">CertificateNotFound</a> EventHandler of ApplicationInstanceBase. If the check box is checked in this case, the configuration of the application gets updated with information about the new certificate.</p>
<div class="fragment"><div class="line">        <span class="keyword">public</span> CreateCertificateDialog()</div>
<div class="line">        {</div>
<div class="line">            InitializeComponent();</div>
<div class="line">            Icon = GuiUtils.GetDefaultIcon();</div>
<div class="line">            this.CancelButton = this.CloseButton;</div>
<div class="line"></div>
<div class="line">            SecurityRightsLabel.Visible = !SecurityUtils.CheckIfProcessHasAdminRights();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> value <span class="keywordflow">in</span> Enum.GetValues(typeof(KeySize)))</div>
<div class="line">            {</div>
<div class="line">                KeySizeComboBox.Items.Add(value);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            KeySizeComboBox.SelectedIndex = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> value <span class="keywordflow">in</span> Enum.GetValues(typeof(HashAlgorithm)))</div>
<div class="line">            {</div>
<div class="line">                HashAlgorithmComboBox.Items.Add(value);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            HashAlgorithmComboBox.SelectedIndex = 0;</div>
<div class="line"></div>
<div class="line">            PasswordTextBox.MouseEnter += PasswordTextBox_MouseEnter;</div>
<div class="line"></div>
<div class="line">            BasicButton_Click(<span class="keyword">this</span>, null);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> PasswordTextBox_MouseEnter(<span class="keywordtype">object</span> sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            ToolTip tt = <span class="keyword">new</span> ToolTip()</div>
<div class="line">            {</div>
<div class="line">                InitialDelay = 250,</div>
<div class="line">                ShowAlways = <span class="keyword">true</span></div>
<div class="line">            };</div>
<div class="line">            tt.SetToolTip(PasswordTextBox, <span class="stringliteral">&quot;If you create a password that is secured by&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot; a password, the certificate cannot be loaded by the SDK directly after&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot; checking the configuration\nbecause there is no specified way to store &quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot; the password within the configuration.\n&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;You have to load the certificate directly in the code.&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ClientTutorials.html">Tutorials for Client development</a></li><li class="navelem"><a class="el" href="L2ClientTutExamples.html">Getting Started</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
