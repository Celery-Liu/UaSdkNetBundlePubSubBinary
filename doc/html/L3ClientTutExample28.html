<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Read – Read Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ClientTutExample28.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Read – Read Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ClientTutExample28Pre">Prerequisites</a></li>
<li class="level1"><a href="#L4ClientTutExample28Desc">Description</a></li>
<li class="level1"><a href="#L4ClientTutExample28Code">Sample Code</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L4ClientTutExample28Pre"></a>
Prerequisites</h1>
<p>A session with the server must be established.</p>
<h1><a class="anchor" id="L4ClientTutExample28Desc"></a>
Description</h1>
<p>This example demonstrates how to read values having structured data types that are unknown at compile time. Press the button “Show Code” to display the corresponding code, and the button “Help” to show this documentation page.</p>
<div class="image">
<img src="clienttutorials_read_structure.png" alt="clienttutorials_read_structure.png"/>
</div>
<p>Fill in a Node ID to the respective input field. Press the button “…” to open a tree view for browsing the server’s address space. When clicking the button “Read”, the value is displayed in the box at “Read Response”. Check the box in front of “Use Asynchronous Pattern” to call “BeginRead” instead of “Read”.</p>
<p>The example contains two variants for displaying the value. The text box only supports simple data types and structured data types without optional fields.</p>
<div class="image">
<img src="clienttutorials_read_structure3.png" alt="clienttutorials_read_structure3.png"/>
</div>
<p>In the second variant, values are shown in a tree view. This more complicated example can additionally be used for unions, enumerations, and structured data types with optional fields.</p>
<div class="image">
<img src="clienttutorials_read_structure2.png" alt="clienttutorials_read_structure2.png"/>
</div>
<h1><a class="anchor" id="L4ClientTutExample28Code"></a>
Sample Code</h1>
<p>For using SDK functionality to parse value with a (at compile time) unknown structured DataType it is necessary to create an instance of the <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1DataTypeDefinitionManager.html">DataTypeDefinitionManager</a> first.</p>
<div class="fragment"><div class="line">            m_dataTypeManager = <span class="keyword">new</span> DataTypeDefinitionManager(m_parent.Session);</div>
</div><!-- fragment --><p> Then we extract the ExtensionObject from the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1DataValue.html">DataValue</a> and pass it to the <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1DataTypeDefinitionManager.html">DataTypeDefinitionManager</a></p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericEncodeableStructure.html" title="Contains the field values of a structured DataType described by a GenericStructuredDataTypeDefinition...">UnifiedAutomation.UaBase.GenericEncodeableStructure</a></li>
</ul>
<div class="fragment"><div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> dv = results[0];</div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a> value = dv.WrappedValue;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Only ExtensionObjects are allowed for this example</span></div>
<div class="line">                <span class="keywordflow">if</span> (value.DataType != <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328">BuiltInType</a>.ExtensionObject || value.ValueRank != ValueRanks.Scalar)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Only scalar values of structured DataTypes can be displayed in this example&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a1adf19f65f9aa28f3b51d77b73f6b688">ExtensionObject</a> e = value.ToExtensionObject();</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (e.Encoding == <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#ae9a8e9e3372a6c4ef70206a23187a602">ExtensionObjectEncoding</a>.EncodeableObject)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Only values of structured DataTypes that are not registered at the stack can be shown in this example.&quot;</span>);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">// The DataTypeDefinitionManager parses the encoded data</span></div>
<div class="line">                var task = m_dataTypeManager.ParseValueAsync(e);</div>
<div class="line">                var encodeable = task.GetAwaiter().GetResult();</div>
</div><!-- fragment --><p> The following paragraphs only show how to print the value to a text box. See the complete example code for the more elaborate tree view.</p>
<p>Structures may be nested, so a recursive method is needed to show a structure’s content.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericStructuredDataTypeDefinition.html" title="Class describing a structure or a union. ">UnifiedAutomation.UaBase.GenericStructuredDataTypeDefinition</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericEncodeableStructure.html" title="Contains the field values of a structured DataType described by a GenericStructuredDataTypeDefinition...">UnifiedAutomation.UaBase.GenericEncodeableStructure</a></li>
</ul>
<div class="fragment"><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> PrintValue(GenericEncodeableStructure genericValue)</div>
<div class="line">        {</div>
<div class="line">            m_text.Text = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (genericValue == null)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Extract the data type description</span></div>
<div class="line">            GenericStructuredDataTypeDefinition structuredDataType = genericValue.DataType;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// We have a structure, process structure elements</span></div>
<div class="line">            m_text.Text = structuredDataType.Name;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Use a recursive method, because structures can be nested.</span></div>
<div class="line">            PrintValueRec(genericValue, 1);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> PrintValueRec(GenericEncodeableStructure genericValue, <span class="keywordtype">int</span> depth)</div>
<div class="line">        {</div>
</div><!-- fragment --><p> We get the fields of the structure and iterate over these fields.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericStructuredDataTypeDefinition.html" title="Class describing a structure or a union. ">UnifiedAutomation.UaBase.GenericStructuredDataTypeDefinition</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericStructureField.html" title="Describes the a field of a GenericStructureDataTypeDefinition. ">UnifiedAutomation.UaBase.GenericStructureField</a></li>
</ul>
<div class="fragment"><div class="line">            GenericStructuredDataTypeDefinition structuredDataType = genericValue.DataType;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; depth; i++)</div>
<div class="line">            {</div>
<div class="line">                intend += <span class="stringliteral">&quot;  &quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; structuredDataType.Fields.Count; i++)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Get the description of the field (name, data type etc.)</span></div>
<div class="line">                var fieldDescription = structuredDataType.Fields[i];</div>
<div class="line">                <span class="comment">// Get the value of the field</span></div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a> fieldValue = genericValue[i];</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">string</span> fieldName = fieldDescription.Name;</div>
</div><!-- fragment --><p> Then we have to check the TypeClass and ValueRank of each field. If a field contains a structured DataType, the recursive method is called again.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1GenericEncodeableStructure.html" title="Contains the field values of a structured DataType described by a GenericStructuredDataTypeDefinition...">UnifiedAutomation.UaBase.GenericEncodeableStructure</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1ExtensionObjectCollection.html" title="A collection of ExtensionObject values. ">UnifiedAutomation.UaBase.ExtensionObjectCollection</a></li>
</ul>
<div class="fragment"><div class="line">                <span class="keywordflow">if</span> (fieldDescription.ValueRank == ValueRanks.Scalar)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (fieldDescription.DataType is GenericSimpleDataTypeDefinition)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// Print the name and the value</span></div>
<div class="line">                        <span class="keywordtype">string</span> outputString = <span class="stringliteral">&quot;\r\n&quot;</span> + intend + fieldName + <span class="stringliteral">&quot; = &quot;</span> + fieldValue;</div>
<div class="line">                        m_text.Text += outputString;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fieldDescription.DataType is GenericStructuredDataTypeDefinition)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// Print the name and call this method again the child</span></div>
<div class="line">                        <span class="keywordtype">string</span> outputString = <span class="stringliteral">&quot;\r\n&quot;</span> + intend + fieldName;</div>
<div class="line">                        m_text.Text += outputString;</div>
<div class="line">                        PrintValueRec((GenericEncodeableStructure)fieldValue.GetValue&lt;GenericEncodeableStructure&gt;(null), depth + 1);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fieldDescription.ValueRank == ValueRanks.OneDimension)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Print the fields name</span></div>
<div class="line">                    <span class="keywordtype">string</span> outputString = <span class="stringliteral">&quot;\r\n&quot;</span> + intend + fieldName;</div>
<div class="line">                    m_text.Text += outputString;</div>
<div class="line">                    <span class="keywordflow">if</span> (fieldDescription.DataType is GenericSimpleDataTypeDefinition)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// Print each element</span></div>
<div class="line">                        Array array = fieldValue.Value as Array;</div>
<div class="line">                        <span class="keywordtype">int</span> counter = 0;</div>
<div class="line">                        <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> element <span class="keywordflow">in</span> array)</div>
<div class="line">                        {</div>
<div class="line">                            outputString = <span class="stringliteral">&quot;\r\n&quot;</span> + intend + <span class="stringliteral">&quot;  &quot;</span> + fieldDescription.DataType.Name + <span class="stringliteral">&quot;[&quot;</span> + counter++ + <span class="stringliteral">&quot;]: &quot;</span> + element.ToString();</div>
<div class="line">                            m_text.Text += outputString;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fieldDescription.DataType is GenericStructuredDataTypeDefinition)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">// Call this method again for each element</span></div>
<div class="line">                        ExtensionObjectCollection extensionObjects = fieldValue.ToExtensionObjectArray();</div>
<div class="line">                        <span class="keywordtype">int</span> counter = 0;</div>
<div class="line">                        <span class="keywordflow">foreach</span> (ExtensionObject e <span class="keywordflow">in</span> extensionObjects)</div>
<div class="line">                        {</div>
<div class="line">                            outputString = <span class="stringliteral">&quot;\r\n&quot;</span> + intend + <span class="stringliteral">&quot;  &quot;</span> + fieldDescription.DataType.Name + <span class="stringliteral">&quot;[&quot;</span> + counter++ + <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">                            m_text.Text += outputString;</div>
<div class="line">                            PrintValueRec((GenericEncodeableStructure)e.Body, depth + 2);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ClientTutorials.html">Tutorials for Client development</a></li><li class="navelem"><a class="el" href="L2ClientTutExamples.html">Getting Started</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
