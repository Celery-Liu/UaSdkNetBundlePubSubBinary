<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Write Implementation for DiscreteItemTypes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ServerTuDemoServerWriteImpl.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Write Implementation for DiscreteItemTypes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#DemoServerExampleDiscreteItemTypes_1">TwoStateDiscreteType</a></li>
<li class="level1"><a href="#DemoServerExampleDiscreteItemTypes_2">MultiStateDiscreteType</a></li>
<li class="level1"><a href="#DemoServerExampleDiscreteItemTypes_3">MultiStateValueDiscreteType</a></li>
</ul>
</div>
<div class="textblock"><p>The DemoServer Address Space contains examples of the following Subtypes of the DiscreteItemType in Demo → 010_ComplianceTest → DA Profile → DataItemDiscreteType:</p>
<ol type="1">
<li>TwoStateDiscreteType</li>
<li>MultiStateDiscreteType</li>
<li>MultiStateValueDiscreteType</li>
</ol>
<h1><a class="anchor" id="DemoServerExampleDiscreteItemTypes_1"></a>
TwoStateDiscreteType</h1>
<p>The DataType of an instance of TwoStateDiscreteType is Boolean. The text representing the value is stored in the properties TrueState and FalseState. So it is not necessary to prevent clients from writing values that are not allowed.</p>
<h1><a class="anchor" id="DemoServerExampleDiscreteItemTypes_2"></a>
MultiStateDiscreteType</h1>
<p>Instances of a MultiStateDiscreteType have a property called EnumStrings. The value of this property is an array of LocalizedTexts. The corresponding text for a value can be found at the array index of the value of the property. E.g. the corresponding textual representation of the value 2 can be found at the array index 2 of the value of the property.</p>
<p>So the allowed values for an instance of MultiStateDiscreteType are:<br />
 0 ≤ allowed value &lt; array length.</p>
<p>If a client tries to write a value that is not allowed, the server has to return BadOutOfRange (see example code below). The code snippet is taken from the class EnumStringDataSource which can be found in the file Demo → ValueDataStore.cs in the Visual Studio Solution for the Demo Server.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1TypeUtils.html#ae477779a3a8c568bdf9daf360d27595a">UnifiedAutomation.UaBase.TypeUtils.IsInstanceOfDataType</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1StatusCodes.html">UnifiedAutomation.UaBase.StatusCodes</a></li>
</ul>
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca1129c0e4d43f2d121652a7302712cff6">Write</a>(<span class="keywordtype">int</span> componentIndex, Variant value, StatusCode status, DateTime timestamp)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (timestamp == <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.MinValue)</div>
<div class="line">            {</div>
<div class="line">                timestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (componentIndex == 0)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation.html">UnifiedAutomation</a>.<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html">UaBase</a>.<a class="code" href="classUnifiedAutomation_1_1UaBase_1_1TypeInfo.html">TypeInfo</a> typeInfo = TypeUtils.IsInstanceOfDataType(value, TypeInfo);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (typeInfo == null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> StatusCodes.BadTypeMismatch;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">try</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> newValue = value.ToInt32();</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (newValue &gt;= 0 &amp;&amp; newValue &lt; EnumStrings.Length)</div>
<div class="line">                    {</div>
<div class="line">                        SelectedIndex = newValue;</div>
<div class="line">                        <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#af27805b09b626fe73d8b4e72fbb547c9aec53a8c4f07baed5d8825072c89799be">Status</a> = status;</div>
<div class="line">                        <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a2b578518a1c3cf9a85fa5cf472e22ba7aa3d5de3eac8bb00ae86fd1a1005f1500">Timestamp</a> = timestamp;</div>
<div class="line">                        <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// assume out of range error.</span></div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> StatusCodes.BadOutOfRange;</div>
<div class="line">            }</div>
</div><!-- fragment --><h1><a class="anchor" id="DemoServerExampleDiscreteItemTypes_3"></a>
MultiStateValueDiscreteType</h1>
<p>The behavior for an instance of MultiStateValueDiscretetType is quite similar. The instances have a property called EnumValues. The value of this property contains an array of EnumValueType. I.e. the value contains an array of value-text pairs. So the server has to check wheter the value of the property contains the value to write (see example below). The code snippet is taken from the class EnumValueDataSource which can be found in the file Demo → ValueDataStore.cs in the Visual Studio Solution for the Demo Server.</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1TypeUtils.html#ae477779a3a8c568bdf9daf360d27595a">UnifiedAutomation.UaBase.TypeUtils.IsInstanceOfDataType</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaBase_1_1StatusCodes.html">UnifiedAutomation.UaBase.StatusCodes</a></li>
</ul>
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca1129c0e4d43f2d121652a7302712cff6">Write</a>(<span class="keywordtype">int</span> componentIndex, Variant value, StatusCode status, DateTime timestamp)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (timestamp == <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.MinValue)</div>
<div class="line">            {</div>
<div class="line">                timestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (componentIndex == 0)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation.html">UnifiedAutomation</a>.<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html">UaBase</a>.<a class="code" href="classUnifiedAutomation_1_1UaBase_1_1TypeInfo.html">TypeInfo</a> typeInfo = TypeUtils.IsInstanceOfDataType(value, TypeInfo);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (typeInfo == null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> StatusCodes.BadTypeMismatch;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">try</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">long</span> newValue = value.ToInt64();</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; EnumValues.Length; ii++)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">if</span> (EnumValues[ii].Value == newValue)</div>
<div class="line">                        {</div>
<div class="line">                            SelectedIndex = ii;</div>
<div class="line">                            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#af27805b09b626fe73d8b4e72fbb547c9aec53a8c4f07baed5d8825072c89799be">Status</a> = status;</div>
<div class="line">                            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a2b578518a1c3cf9a85fa5cf472e22ba7aa3d5de3eac8bb00ae86fd1a1005f1500">Timestamp</a> = timestamp;</div>
<div class="line">                            <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">catch</span> (Exception)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// assume out of range error.</span></div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> StatusCodes.BadOutOfRange;</div>
<div class="line">            }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutDemoServer.html">.NET SDK Demo Server</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
