<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Toolkit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L2ServerSdkServerManBaseNodeMan.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Toolkit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L3ServerSdkServerManBaseNodeManOverview">Overview</a></li>
<li class="level1"><a href="#L3ServerSdkServerManBaseNodeManDataAccessEtc">Data Access, Handle Types and the IIOManager</a></li>
<li class="level1"><a href="#L3ServerSdkServerManBaseNodeManIEventManagerEtc">IEventManager and the Notifier Hierarchy</a></li>
<li class="level1"><a href="#L3ServerSdkServerManBaseNodeManIMethodManagerEtc">IMethodManager and IMethodDispatcher</a></li>
<li class="level1"><a href="#L3ServerSdkServerManBaseNodeManINodeManagementManagerEtc">INodeManagementManager and ImportUaNodeSet</a></li>
<li class="level1"><a href="#L3ServerSdkServerManBaseNodeManServerInternalClientEtc">ServerInternalClient and IAdvancedNodeManager</a></li>
<li class="level1"><a href="#L3ServerSdkToolkitLocking">Locking</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManOverview"></a>
Overview</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> implements all of the manager interfaces and provides access to a set of in-memory Nodes. It also provides functions that can be overloaded by a subclass to access data for some or all of the in-memory Nodes or to generate events based on application specific logic.</p>
<h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManDataAccessEtc"></a>
Data Access, Handle Types and the IIOManager</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> uses UInt32 values called handle types to control how Node attributes are accessed. The user can set the handle type when the Node is created (via one of the Create&lt;NodeClass&gt; overloads) or with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a8838aedb110dd8993b971fe8876d11d5">SetNodeAttributeConfiguration</a> or <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#aa4823360c9834bbe65db31dd932b544b">SetVariableConfiguration</a> methods. The following handle types are supported by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a>: </p>
<dl>
<dt>Internal<a class="anchor" id="BaseNodeManHandleTypeInternal"></a> </dt>
<dd><p class="startdd">The attribute value is stored in the memory cache maintained by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a>. Any writes will cause the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#add0a37e23cdf0bcf0b7bc90b2eb42afd">ReportDataChanges</a> method to be called which updates any MonitoredItems.</p>
<p class="enddd"></p>
</dd>
<dt>InternalPolled<a class="anchor" id="BaseNodeManHandleTypeInternalPolled"></a> </dt>
<dd><p class="startdd">The attribute value is linked by reflection to a property of a class instance in memory. The association is created with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a44959d41c84b5f034d4d13242be5023e">LinkModelToNode</a> method and the caller is responsible for keeping a reference to the linked instance. If this attribute value is subscribed, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> will periodically poll the value and report any data changes.</p>
<p class="enddd"></p>
</dd>
<dt>InternalPush<a class="anchor" id="BaseNodeManHandleTypeInternalPush"></a> </dt>
<dd><p class="startdd">The attribute value is stored in the memory cache maintained by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a>. The type is typically used by the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IModelManager.html#a0e7721d4bc3f6c894cd8fad95c16ea13">BindModel</a> method. Changes on the model are pushed to the node memory. External writes are re-directed to the model.</p>
<p class="enddd"></p>
</dd>
<dt>ExternalPolled<a class="anchor" id="BaseNodeManHandleTypeExternalPolled"></a> </dt>
<dd><p class="startdd">The attribute value is stored in an external system. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a44959d41c84b5f034d4d13242be5023e">BaseNodeManager</a> will return an error if the attribute value is accessed and it is up to the subclass to override the Read/Write methods and provide the logic. If the node is subscribed to, then the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> will periodically call the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a4121de459e7f3f7260d57e158c85d9c6">Read</a> method and report any data changes.</p>
<p class="enddd"></p>
</dd>
<dt>ExternalPush<a class="anchor" id="BaseNodeManHandleTypeExternalPush"></a> </dt>
<dd><p class="startdd">The attribute value is stored in an external system. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> will return an error if the attribute value is accessed and it is up to the subclass to override the Read/Write/StartMonitoring/StopMontoring methods and provide the logic required.</p>
<p class="enddd"></p>
</dd>
<dt>VendorDefined<a class="anchor" id="BaseNodeManHandleTypeVendorDefined"></a> </dt>
<dd>Subclasses can create additional handle types starting with this value. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> treats all handle types greater than ExternalPush as ExternalPush. </dd>
</dl>
<p>The <a class="el" href="L2ServerSdkServerManBaseNodeMan.html#BaseNodeManHandleTypeInternalPolled">InternalPolled</a> and <a class="el" href="L2ServerSdkServerManBaseNodeMan.html#BaseNodeManHandleTypeInternalPolled">InternalPush</a> handle types allow the use of reflection to link user defined classes to an information model. This requires that the class properties are decorated with the UaInstanceDeclaration attribute such as shown in the following code snippet:</p>
<div class="fragment"><div class="line">[UaTypeDefinition(NodeId=ObjectTypes.FileType, NamespaceUri=Namespaces.OpcUa)]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">partial class </span>FileModel</div>
<div class="line">{</div>
<div class="line">    [UaInstanceDeclaration(NamespaceUri = Namespaces.OpcUa)]</div>
<div class="line">    <span class="keyword">public</span> ushort OpenCount { <span class="keyword">get</span>; set; }</div>
<div class="line"></div>
<div class="line">    [UaInstanceDeclaration(NamespaceUri = Namespaces.OpcUa)]</div>
<div class="line">    <span class="keyword">public</span> ulong Size { <span class="keyword">get</span>; set; }</div>
<div class="line"></div>
<div class="line">    [UaInstanceDeclaration(NamespaceUri = Namespaces.OpcUa)]</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">bool</span> UserWriteable { <span class="keyword">get</span>; set; }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This class could be associated with any Object Node with a TypeDefinition FileType. The value of the OpenCount Variable Node would be mapped to the OpenCount property.</p>
<p>If an attribute value is a LocalizedText, then the user can tell the SDK to automatically translate the text with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ResourceManager.html">ResourceManager</a> by specifying a value for the Key property. The translation occurs when the value is added to the queue of a MonitoredItem.</p>
<p>The following methods can be overridden by the subclass to customize I/O operations:</p>
<dl>
<dt>Read (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls BeginRead. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>Read (&lt;multiple nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in.</p>
<p class="enddd"></p>
</dd>
<dt>Write (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls BeginWrite. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>Write (&lt;multiple nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in.</p>
<p class="enddd"></p>
</dd>
<dt>StartDataMonitoring (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the Subscription calls BeginStartDataMonitoring. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>StartDataMonitoring (&lt;multiple nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in.</p>
<p class="enddd"></p>
</dd>
<dt>StopDataMonitoring (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the Subscription calls BeginStopDataMonitoring. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>StopDataMonitoring (&lt;multiple nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in.</p>
<p class="enddd"></p>
</dd>
<dt>ModifyDataMonitoring (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the Subscription calls BeginModifyDataMonitoring. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>ModifyDataMonitoring (&lt;multiple nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in.</p>
<p class="enddd"></p>
</dd>
<dt>SetDataMonitoringMode (&lt;single nodes&gt;) </dt>
<dd><p class="startdd">This method is called when the Subscription calls BeginSetDataMonitoringMode. The overridden implementation must not block and returns null if the Node should be processed as part of a transaction.</p>
<p class="enddd"></p>
</dd>
<dt>SetDataMonitoringMode (&lt;multiple nodes&gt;) </dt>
<dd>This method is called when the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> calls FinishDataTransaction. This method can block and must invoke the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> completion callback for each operation passed in. </dd>
</dl>
<h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManIEventManagerEtc"></a>
IEventManager and the Notifier Hierarchy</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> maintains an in memory representation of the notifier hierarchy. It is optimized to allow for fast propagation of events up the hierarchy. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#aff894ce20df419337e9ef57ad5388597">AddNotifier</a> method can be used to add new notifiers to this cache; however, this is also done automatically whenever a HasNotifier reference is added via <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a73d60571902d3b2d49a4639115141944">AddNode</a> or <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#ada052041be4314b7465d359041457298">AddReference</a> methods (or via any of the Create&lt;NodeClass&gt; methods).</p>
<p>This cache allows applications to create events once, set the source and call the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a4ce135efd3b4a6670848db7862bc558f">BaseNodeManager ReportEvent</a> method. The SDK will take care of walking up the hierarchy and reporting the event to every currently active MonitoredItem.</p>
<p>An event created with a Server is an instance of a <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1GenericEvent.html">GenericEvent</a> class. This class requires an instance of <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1FilterManager.html">FilterManager</a> (a property on the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a> instance). The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1FilterManager.html">FilterManager</a> assigns handles to all known sequences of BrowseNames (also called a BrowsePath). Events that are created rarely can be populated with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1GenericEvent.html#ad95fbca3668e960fa5a2ce0b139371aa">Set</a> methods that take a hardcoded BrowsePath as an argument as shown in the following code snippet:</p>
<div class="fragment"><div class="line">GenericEvent e = <span class="keyword">new</span> GenericEvent(<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a4ee1c62aa1346abfd54798f6d167a766a9aa1b03934893d7134a660af4204f2a9">Server</a>.FilterManager);</div>
<div class="line"></div>
<div class="line"><a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a26889eee67d7ccc649f6188d0c20ad2b">LocalizedText</a> message = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a26889eee67d7ccc649f6188d0c20ad2b">LocalizedText</a>(</div>
<div class="line">    <span class="stringliteral">&quot;DeviceFailedMessage&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;en-US&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;The device has failed for with error {0}.&quot;</span>,</div>
<div class="line">    errorCode);</div>
<div class="line"></div>
<div class="line">e.Initialize(</div>
<div class="line">    null,</div>
<div class="line">    ObjectTypeIds.DeviceFailureEventType,</div>
<div class="line">    sourceNode,</div>
<div class="line">    sourceName,</div>
<div class="line">    <a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#a53eb44cce8051866958dfef2effb3bd0">EventSeverity</a>.High,</div>
<div class="line">    message);</div>
<div class="line"></div>
<div class="line">e.Set(<span class="stringliteral">&quot;DeviceId&quot;</span>, deviceId);</div>
<div class="line">e.Set(<span class="stringliteral">&quot;LastGoodStatus&quot;</span>, lastGoodStatus);</div>
<div class="line">e.Set(<span class="stringliteral">&quot;LastGoodStatus/Timestamp&quot;</span>, timestamp);</div>
</div><!-- fragment --><p>The first argument of the <a class="el" href="classUnifiedAutomation_1_1UaBase_1_1LocalizedText.html">LocalizedText</a> constructor is a key that is used by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ResourceManager.html">ResourceManager</a> to look up translations of the default text. If no translation is found, the default text is used. This allows the framework to automatically translate the LocalizedText into the locales required by different MonitoredItems.</p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1GenericEvent.html#ab63c82ed60c31544e554a93a72adea98">Initialize</a> method is used to set the event fields required to process the event within the SDK (EventId, EventType, SourceNode and Time). If any mandatory field is set to null, a suitable default is chosen. If the four required fields need to be overridden, the properties on the GenericEvent object need to be set explicitly. Calling the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1GenericEvent.html#ad95fbca3668e960fa5a2ce0b139371aa">Set</a> method will mean the SDK will not see the changes.</p>
<p>If an event is created over and over again, the user should register the BrowsePath with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1FilterManager.html#abc80411b9f4ff072a0cf30f3fd73d429">FilterManager.CreateFieldHandle</a> method and save the handle returned. When a new instance of the event is created, the field values should be set using this saved handle. The code generated by the UaModeler includes code to save and use these handles when filling in an event.</p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> also provides methods which are called when operations are performed on notifiers in the hierarchy that can affect the state of nodes below it. These methods are summarized in the following:</p>
<dl>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a6b6d7a5a696d1bd970e902d36ccda1a9">OnMonitoringStarted</a> </dt>
<dd><p class="startdd">Called when a MonitoredItem is created or moves from the Disabled state for a notifier at or above the notifier passed to the call.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#af4604733c4ed8314b6eab4830952a198">OnMonitoringModified</a> </dt>
<dd><p class="startdd">Called when a MonitoredItem is modified for a notifier at or above the notifier passed to the call.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a7ea147892cc3c822910d799a0f40c627">OnMonitoringStopped</a> </dt>
<dd><p class="startdd">Called when a MonitoredItem is deleted or moves to the Disabled state for a notifier at or above the notifier passed to the call.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a892a19b1b11f86f0fc2fd9b25d00b88b">OnConditionRefresh</a> </dt>
<dd>Called when ConditionRefresh is called for a MonitoredItem for a notifier at or above the notifier passed to the call. </dd>
</dl>
<p>The SDK also provides helper classes for all of the OPC UA defined event types such as AlarmType. </p>
<p>The classes can be used to store “templates” for events that can be raised over and over. The following snippet initializes one of these classes (by convention the class name is the same as the event type except “Type” is replaced with “Model”):</p>
<div class="fragment"><div class="line"><span class="comment">// create an in memory object that can be used to manage the alarm.</span></div>
<div class="line">ExclusiveLevelAlarmModel alarm = <span class="keyword">new</span> ExclusiveLevelAlarmModel();</div>
<div class="line"></div>
<div class="line">alarm.NodeId = alarmId;</div>
<div class="line">alarm.EventType = ObjectTypeIds.ExclusiveLimitAlarmType;</div>
<div class="line">alarm.SourceNode = controllerId;</div>
<div class="line">alarm.SourceName = block.Name;</div>
<div class="line">alarm.Message = <span class="stringliteral">&quot;Controller is not maintaining temperature.&quot;</span>;</div>
<div class="line">alarm.Severity = (ushort)<a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#a53eb44cce8051866958dfef2effb3bd0">EventSeverity</a>.Low;</div>
<div class="line">alarm.ConditionName = <span class="stringliteral">&quot;TemperatureAlarm&quot;</span>;</div>
<div class="line">alarm.ConditionClassId = ObjectTypeIds.ProcessConditionClassType;</div>
<div class="line">alarm.ConditionClassName = BrowseNames.ProcessConditionClassType;</div>
<div class="line">alarm.Retain = <span class="keyword">false</span>;</div>
<div class="line">alarm.EnabledState.Value = ConditionStateNames.Enabled;</div>
<div class="line">alarm.EnabledState.Id = <span class="keyword">true</span>;</div>
<div class="line">alarm.AckedState.Value = ConditionStateNames.Acknowledged;</div>
<div class="line">alarm.AckedState.Id = <span class="keyword">true</span>;</div>
<div class="line">alarm.ActiveState.Value = ConditionStateNames.Inactive;</div>
<div class="line">alarm.ActiveState.Id = <span class="keyword">false</span>;</div>
<div class="line">alarm.SuppressedOrShelved = <span class="keyword">false</span>;</div>
<div class="line">alarm.HighLimit = 35;</div>
<div class="line">alarm.LowLimit = 15;</div>
<div class="line">alarm.InputNode = temperatureVariable;</div>
</div><!-- fragment --><p>The following code snippet will raise an event based on the in memory object:</p>
<div class="fragment"><div class="line">GenericEvent e = alarm.CreateEvent(<a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a4ee1c62aa1346abfd54798f6d167a766a9aa1b03934893d7134a660af4204f2a9">Server</a>.FilterManager);</div>
<div class="line">ReportEvent(alarm.SourceNode, e);</div>
</div><!-- fragment --><p>These convenience classes can be created for a user defined information model with the UaModeler tool that can be downloaded from the Unified Automation website.</p>
<h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManIMethodManagerEtc"></a>
IMethodManager and IMethodDispatcher</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> implements the Call service for Objects which belong to the NodeManager. The Method is expected to be in the same NodeManager or the Method defined on the TypeDefinition for the Object. </p>
<p>When the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a48715229c90163c976ee97db8354d0fb">GetMethodHandle</a> method is called, a delegate for the method implementation needs to be found. First, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> looks in the UserData associated with the Object Node (set by calling the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#af569530f08d913c0753e6ce29c4e3ff0">SetNodeUserData</a> method). If the UserData supports the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IMethodDispatcher.html">IMethodDispatcher interface</a>, then <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a1fd9d087f4fe9b046136a508de42a622">GetMethodDispatcher</a> is called on the UserData. Otherwise, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a1fd9d087f4fe9b046136a508de42a622">GetMethodDispatcher</a> method on the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> is called. If <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a1fd9d087f4fe9b046136a508de42a622">GetMethodDispatcher</a> returns a null, then a Bad_NotImplemented error will be returned to the Client.</p>
<p>When the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a0f76d895874d2a75be702b9b54a6c92f">FinishCallTransaction</a> method is called by the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html">ServerManager</a>, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> will call the <b>CallMethod</b> method for each operation in the transaction. This method validates the input arguments by checking the number and the data type. It also creates an array of output arguments which are initialized with the default values for the data type.</p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> finds the input and output arguments by reading the value of the InputArguments and OutputArguments properties of the Method Node. For better performance these properties should be stored in memory.</p>
<p>If the input arguments are valid, the delegate returned by <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a1fd9d087f4fe9b046136a508de42a622">GetMethodDispatcher</a> is called. If this method throws an exception, it is caught and an error status is returned for the operation. The implementer of the method does not need to check the number and type of arguments since the caller has already done this. Other checks may be required depending on the method call.</p>
<p>The following code snippet illustrates how to implement the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IMethodDispatcher.html">IMethodDispatcher</a> on an Object that can be set as the UserData for a Node.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>FileModel : IMethodDispatcher</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Gets the method dispatcher.</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#a60d4b54d03daba2f1472b6901039c342">CallMethodEventHandler</a> GetMethodDispatcher(RequestContext context,</div>
<div class="line">                                                              NodeId objectId,</div>
<div class="line">                                                              NodeId methodId)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> DispatchMethod;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Dispatches the method.</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a> DispatchMethod(RequestContext context,</div>
<div class="line">                                             MethodHandle methodHandle,</div>
<div class="line">                                             IList&lt;Variant&gt; inputArguments,</div>
<div class="line">                                             List&lt;StatusCode&gt; inputArgumentResults,</div>
<div class="line">                                             List&lt;Variant&gt; outputArguments)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// use the NodeId of the method defined on the TypeDefinition as a constant.</span></div>
<div class="line">        <span class="keywordflow">if</span> (methodHandle.MethodDeclarationId == MethodIds.FileType_Open.ToNodeId(context.NamespaceUris))</div>
<div class="line">        {</div>
<div class="line">            uint mode = inputArguments[0].ToByte();</div>
<div class="line">            uint fileHandle = 0;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// implementation can throw StatusExceptions to report errors back to the client.</span></div>
<div class="line">            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a7e8919546a73f7ac97b95072f1e76265ac3bf447eabe632720a3aa1a7ce401274">Open</a>(context, mode, out fileHandle);</div>
<div class="line"></div>
<div class="line">            outputArguments[0] = fileHandle;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (methodHandle.MethodDeclarationId == MethodIds.FileType_Close.ToNodeId(context.NamespaceUris))</div>
<div class="line">        {</div>
<div class="line">            uint fileHandle = inputArguments[0].ToUInt32();</div>
<div class="line"></div>
<div class="line">            Close(context, fileHandle);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> StatusCodes.BadNotImplemented;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The SDK includes an implementation of <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IMethodDispatcher.html">IMethodDispatcher</a> for UA defined ObjectTypes such as AlarmTypes. This implementation invokes methods on an interface (called I&lt;TypeName&gt;Methods) containing all methods defined for the ObjectType.</p>
<p>These standard <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IMethodDispatcher.html">IMethodDispatcher</a> implementations can be created for a user defined information model with the UaModeler tool that can be downloaded from the Unified Automation website.</p>
<h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManINodeManagementManagerEtc"></a>
INodeManagementManager and ImportUaNodeSet</h1>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> allows users to create or delete nodes and references using the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1INodeManagementManager.html">INodeManagementManager</a> interface. In addition, <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> provides simplified helper functions that create instances for each NodeClass (the Create&lt;NodeClass&gt; methods).</p>
<p>When creating Objects or Variables, the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> automatically creates all of the mandatory instances required by the TypeDefinition. The user can request that optional instances are created as well by setting the OptionalBrowsePaths property. The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> determines the structure of the TypeDefinition by browsing the Server address space using the InternalClient object. It caches any results found to improve the performance of subsequent instantiations of the same TypeDefinition.</p>
<p>When Objects or Variables are instantiated, the child Nodes need NodeIds assigned. The NodeIdGenerationSettings property controls the behavior. There are basically two modes that depend on whether a string identifier was passed in as the RequestedNodeId. If the RequestedNodeId has a string, then the NodeIds of the components are constructed by appending the delimiter specified in the settings and the name portion of the BrowseName. If the RequestedNodeId has a type other than string, then new identifiers are created by generating Guids or incrementing a counter in the settings.</p>
<p>Nodes can also be added to the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> with the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html#a38c768b4712530cc1d5772ca3a15374a">ImportUaNodeSet</a> method. This method reads an XML document from a file or a stream that conforms to the UANodeSet schema. During import any reverse references are added, any notifiers are indexed and any new namespace URIs are added to the Server’s namespace table. This method will also register the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a> doing the import as the NodeManager for URIs used by the NodeIds of Nodes defined in the document.</p>
<h1><a class="anchor" id="L3ServerSdkServerManBaseNodeManServerInternalClientEtc"></a>
ServerInternalClient and IAdvancedNodeManager</h1>
<p><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html">ServerInternalClient</a> is a class that calls the same methods that the <a class="el" href="namespaceUnifiedAutomation_1_1UaServer.html">ServerManager</a> calls, however, it provides an API that can be used by other components of the Server process. The primary APIs are as follows:</p>
<ul>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#ace390b070f54c12573678cdcf65294fe">Browse</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a6a818eb07c0ef83153fa96518ad14386">BrowseNext</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a5ac905597d2c8cdb3cbcf7b1702057dc">Translate</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#ada3aa50f143933aeff135cd16a278270">Read</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a3f69132614d425c7cc070e7049213983">Write</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a45aa41c221704ceafe842229f27dcc33">Call</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a875c6f7430881a90a6582bdad1504c0a">CreateDataMonitoredItems</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a88a89ceba256f34e7bcf4447520f57cb">ModifyDataMonitoredItems</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#ac375142eaf5a79ca1e9dbfda0f6efd65">DeleteDataMonitoredItems</a></li>
<li><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a05ea2f8fe6d46d5bc861e6dac98ec2fc">SetMonitoringMode</a></li>
</ul>
<p>The caller passes a delegate into the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a875c6f7430881a90a6582bdad1504c0a">CreateDataMonitoredItems</a> method which is called whenever a data change occurs so there is no need for the Subscribe and Publish services.</p>
<p>The <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html">ServerInternalClient</a> also provides the following helper methods:</p>
<dl>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#adc2c794cee281caaa6aa7a1bf86e1d56">GetNodeMetadata</a> </dt>
<dd><p class="startdd">Returns attributes used during browsing. Includes a mask that allows the caller to specify exactly which attributes are required.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a544c2d64dafe700aa4c58cd6200a1cd7">GetNodeAttributes</a> </dt>
<dd><p class="startdd">Returns all attributes for a given Node.</p>
<p class="enddd"></p>
</dd>
<dt>ReadAttribute&lt; T &gt; </dt>
<dd><p class="startdd">Reads the value of one attribute for a Node. The default value is returned if an error occurs or if the value cannot be cast to the specified type.</p>
<p class="enddd"></p>
</dd>
<dt>ReadValue&lt; T &gt; </dt>
<dd><p class="startdd">Reads the value of a component variable for a Node. The component is specified with the BrowseName or an array of BrowseNames. The default value is returned if an error occurs or if the value cannot be cast to the specified type.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#a1cf994e3e66187e3992b2f6f5dca75b1">WriteAttribute</a> </dt>
<dd><p class="startdd">Writes the value of one attribute for a Node.</p>
<p class="enddd"></p>
</dd>
<dt><a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerInternalClient.html#aaebaeaea80cfbf09d5de73456ee43568">WriteValue</a> </dt>
<dd>Writes the value of a component variable for a Node. The component is specified with the BrowseName or an array of BrowseNames. </dd>
</dl>
<p>The helper methods use the Read, Write, Browse and Translate methods, however, this is often an inefficient way to get the information for some NodeManagers (such as NodeManagers which inherit from <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1BaseNodeManager.html">BaseNodeManager</a>). For this reason the SDK defines the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IAdvancedNodeManager.html">IAdvancedNodeManager interface</a> which allows a NodeManager to directly implement these functions. If the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IAdvancedNodeManager.html">IAdvancedNodeManager interface</a> is not defined on the NodeManager associated with the Node, then the default method is used.</p>
<h1><a class="anchor" id="L3ServerSdkToolkitLocking"></a>
Locking</h1>
<p>The BaseNodeManager provides a InMemoryNodeLock [LINK TO CLASS DOCU]. The lock is needed to synchronize access to the in-memory-node between the SDK and your implementation.</p><ul>
<li>Locking is required when you read or write any property of the in-memory-node (like Value, AccessLevel, Description)</li>
<li>Locking is already encapsulated when creating or deleting in-memory-nodes, so your code does not need to call the lock</li>
</ul>
<p>It is not required to lock the in-memory-nodes while you are initializing (Startup) your NodeManager, but after startup you have to lock them when you access the nodes. Example: </p><div class="fragment"><div class="line">lock (InMemoryNodeLock)</div>
<div class="line">{</div>
<div class="line">    node.Description = description;</div>
<div class="line">}</div>
</div><!-- fragment --><p>As the lock is locking all in-memory-nodes of the whole NodeManager, you should keep the lock as short as possible, and do not have long-lasting operations (like file access) while keeping the lock. If you use generated classes, or helper classes of the SDK representing OPC UA nodes (classes ending with “Model”) you need to lock them, before changing values or calling methods changing the state (like in case of the ConditionModel). In this case, you use the object itself as locking object. Example: </p><div class="fragment"><div class="line">lock (model)</div>
<div class="line">{</div>
<div class="line">    model.TemperatureSetPoint = Math.Max(Math.Min(setPoint, m_boiler1.TemperatureSensor.Temperature.EURange.High), m_boiler1.TemperatureSensor.Temperature.EURange.Low);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that for those generated classes, only accessing of the values is locked. Accessing the meta data (like AccessLevel or Description) is still done via the in-memory-nodes. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerSdkOverview.html">Server SDK Overview</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
