<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Running the example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ServerTuMachineDemoServerRunning.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Running the example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ServerTuMachineDemoServerRunningSetTemp">Changing the temperature</a></li>
<li class="level1"><a href="#L4ServerTuMachineDemoServerRunningInsertJob">Inserting a job</a></li>
<li class="level1"><a href="#L4ServerTuMachineDemoServerRunningProcess">Processing a job</a></li>
<li class="level1"><a href="#L4ServerTuMachineDemoServerRunningEvents">Events and alarms</a></li>
</ul>
</div>
<div class="textblock"><p>In the following section we are going to run the MachineDemoServer and operate it with the UaExpert. Therefore compile and start the MachineDemoServer example, than establish a connection with the UaExpert.</p>
<h1><a class="anchor" id="L4ServerTuMachineDemoServerRunningSetTemp"></a>
Changing the temperature</h1>
<p>First, drag and drop the heater variables for temperature and the temperature setpoint to the DA view of the UaExpert. You can than change the setpoint temperature, in the example we used 400°C.</p>
<div class="image">
<img src="machinedemoserver_settemp1.png" alt="machinedemoserver_settemp1.png"/>
<div class="caption">
Changing the temperature setpoint value</div></div>
<p> The heater will control the temperature until it reaches the setpoint. If you try to enter a negative value the server will confine it to zero. In the log window of the UaExpert, the return status code of <em>GoodClamped</em> can be found. A value greater than 500°C will be completely discarded with a return value of <em>BadOutOfRange</em>.</p>
<div class="image">
<img src="machinedemoserver_settemp2.png" alt="machinedemoserver_settemp2.png"/>
<div class="caption">
Writing unreasonable values to the temperature setpoint variable</div></div>
 <h1><a class="anchor" id="L4ServerTuMachineDemoServerRunningInsertJob"></a>
Inserting a job</h1>
<p>Navigate to the <em>Production</em> object in the Address Space window and expand the <em>ProductionPlan</em> object. The <em>ProductionPlan</em> is empty until now. Right click on the <em>InsertJob</em> method and select the <em>Call</em> context menu item. The <em>Call</em> dialog will popup. Enter an identifier and a Name for the job and press the <em>Call</em> button. In the output arguments section the <em>NodeId</em> of the newly created job will appear. Furthermore, the Job will be listed in the <em>ProductionPlan</em> collection.</p>
<div class="image">
<img src="machinedemoserver_insertjob2.png" alt="machinedemoserver_insertjob2.png"/>
<div class="caption">
Call InsertJob</div></div>
<p> Before we release and start this job, we will create a small watch list of interesting variables. Therefore, drag and drop the state machines <em>MachineryItemState</em> and <em>MachineryOperationMode</em> from the <em>MachineryBuildingBlocks</em> folder as well the <em>StartTime</em>, <em>EndTime</em>, the <em>State</em> and its substate machine from the created Job into the DA view window.</p>
<div class="image">
<img src="machinedemoserver_states1.png" alt="machinedemoserver_states1.png"/>
<div class="caption">
Variables and states</div></div>
<p> The initial state of the <em>MachineryItemState</em> is "NotExecuting", the initial state of the <em>MachineryOperationMode</em> is "Setup", the initial state of the job's state is "Initializing". The "Initializing" state has a substate machine which is in its "Idle" state.</p>
<h1><a class="anchor" id="L4ServerTuMachineDemoServerRunningProcess"></a>
Processing a job</h1>
<p>Before we can queue and release the job for production, we have to supply an instruction plan for the job. This plan contains the process time and the temperature range that should be used for this job. The <em>Instruction</em> object of the job contains a FileType object called <em>Plan</em>. The recipe is transferred to the server via file transfer. Therefore right-click the <em>Plan</em> and select the "Write from local file..." menu item.</p>
<div class="image">
<img src="machinedemoserver_writeplan.png" alt="machinedemoserver_writeplan.png"/>
<div class="caption">
Writing a plan to the instructions.</div></div>
<p> A file dialog will be opened and you can select a file. The file content is in a proprietary format, you find an example file next to the MachineDemoServer executable called <em>ExamplePlan.txt</em>.</p>
<div class="image">
<img src="machinedemoserver_queue.png" alt="machinedemoserver_queue.png"/>
<div class="caption">
Queue the job.</div></div>
<p> Next, call the <em>QueueJob</em> and the <em>ReleaseJob</em> method of the job. The job is now ready to be processed. But the machine is still in the "Setup" state.</p>
<div class="image">
<img src="machinedemoserver_states2.png" alt="machinedemoserver_states2.png"/>
<div class="caption">
Variables and states after calling Release</div></div>
<p> To start the production, call the <em>Process</em> method of the GlassTemperingMachine.</p>
<div class="image">
<img src="machinedemoserver_states3.png" alt="machinedemoserver_states3.png"/>
<div class="caption">
Variables and states after calling Process</div></div>
<p> The operation mode of the machine will change to "Processing", a glass pane will be loaded into the machine, and the state of the job will switch to "Running" and the machine state to "Executing". The start time will now contain a valid value.</p>
<h1><a class="anchor" id="L4ServerTuMachineDemoServerRunningEvents"></a>
Events and alarms</h1>
<p>To test the events and alarms, open a new Event View in the UaExpert (choose <em>Document</em> → <em>Add…</em> from the menu) and drag and drop the GlassTemperingMachine object into the Event View. Now, change the target temperature to 350°C and run a second job as before.</p>
<p>There are two places in the machine demo server where events are generated. The GlassTemperingMachine will report a MaterialReceivedEventType event when a material (glass pane) arrives at the process location and a MaterialExitEventType when the material leaves the machine.</p>
<div class="image">
<img src="machinedemoserver_events.png" alt="machinedemoserver_events.png"/>
<div class="caption">
Events</div></div>
<p> Furthermore, there is a temperature level alarm of the heater. The temperature limits are defined in the plan of the job. As soon as a new job is started, the alarm limits are adjusted.</p>
<div class="image">
<img src="machinedemoserver_alarms.png" alt="machinedemoserver_alarms.png"/>
<div class="caption">
Alarms</div></div>
<p> The alarm can be acknowledged and confirmed in the <em>Alarms</em> tab. If the alarm is acknowledged and confirmed and the job is finished, i.e. the material has left the machine, the alarm will disappear from the list of retained alarms. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutMachineDemoServer.html">Machine Demo Server</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
