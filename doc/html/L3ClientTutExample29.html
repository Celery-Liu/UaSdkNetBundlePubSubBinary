<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Connect – Reverse Connect</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ClientTutExample29.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Connect – Reverse Connect </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#L4ClientTutExample29Desc">Description</a></li>
<li class="level1"><a href="#L4ClientTutExample29Code">Sample Code</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="L4ClientTutExample29Desc"></a>
Description</h1>
<p>The following dialog shows an implementation of the Reverse Connect service. Press the button “Show Code” to display the corresponding code, and the button “Help” to show this documentation page.</p>
<dl class="section note"><dt>Note</dt><dd>Before start make sure Reverse Connect is configured in your server. For information how to configure a server look <a class="el" href="L2BaseLibConfigSchema.html#L3OutgoingReverseConnectionConfiguration">here</a>. </dd>
<dd>
At start, a new session with reverse connetion features is opened. The session will be created with Client Listening URL as parameter. To listen to another URL change the defaultClientListeningURL in ReverseConnectDialog.cs. The settings performed using this dialog window do not affect the other Getting Started Examples.</dd></dl>
<div class="image">
<img src="clienttutorials_reverse_connect.png" alt="clienttutorials_reverse_connect.png"/>
</div>
<p>This example is similar to <a class="el" href="L3ClientTutExample26.html">Advanced Connect</a>. The connection is not established automatically and requires user interaction.</p>
<p>After session creation the client automatically looks for open server channels on the given URL.</p>
<p>Now the following connection process is nearly the same as a normal forward connect.</p>
<p>Enter the servers endpoint URL into "Server URL". By default, this is the Unified Automation .NET Demo Server running on localhost.</p>
<p>Click on “Get Endpoints” to request a list of available Endpoints from the server. Check the box at “Use Asynchronous Pattern” to call BeginGetEndpoints instead of GetEndpoints.</p>
<p>The server’s response is then displayed as a table at “Get Endpoints Response” (see screenshot below).</p>
<div class="image">
<img src="clienttutorials_reverse_connect2.png" alt="clienttutorials_reverse_connect2.png"/>
</div>
<p>Double-click on an entry to display more detailed information for a certain Endpoint.</p>
<div class="image">
<img src="clienttutorials_reverse_connect3.png" alt="clienttutorials_reverse_connect3.png"/>
</div>
<p>Select an Endpoint from the list and click on “Connect” to establish a reverse connection. When choosing a secure endpoint, it is necessary that client and server trust each other’s certificate first (as described in <a class="el" href="L3ClientTutExample5.html#simple_connect_certificates">in the simple connect example</a>).</p>
<p>If successful, the displayed connection state will switch to “Connected”. Check the box at “Use Asynchronous Pattern” to call BeginReverseConnect instead of ReverseConnect.</p>
<div class="image">
<img src="clienttutorials_reverse_connect4.png" alt="clienttutorials_reverse_connect4.png"/>
</div>
<h1><a class="anchor" id="L4ClientTutExample29Code"></a>
Sample Code</h1>
<p>The following code only shows differenses to the forward connect. For forward connect examples look <a class="el" href="L3ClientTutExample26.html#L4ClientTutExample26Code">Advanced Connect</a>.</p>
<p>Create new session with the URL the server is providing channels at. </p><div class="fragment"><div class="line">            m_session = <span class="keyword">new</span> Session(m_parent.Application, defaultClientListeningURL);</div>
</div><!-- fragment --><p> Call ReverseConnect with one of the returned endpoints. </p><div class="fragment"><div class="line">                m_session.ReverseConnect(SelectedEndpoint, m_session.DefaultRequestSettings);</div>
</div><!-- fragment --><p> A callback (OnConnectCompleted) and user data (session) are passed to <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1Session.html#ae292e4ec9e4ec6e15b0c8b4756ed9f05">BeginReverseConnect</a>. The callback casts the user data and calls <a class="el" href="classUnifiedAutomation_1_1UaClient_1_1Session.html#aca71dd832b57471e4439f76d51bb256e">End Connect</a>.</p>
<div class="fragment"><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> BeginReverseConnect()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                m_session.BeginReverseConnect(</div>
<div class="line">                    SelectedEndpoint,</div>
<div class="line">                    <a class="code" href="group__GroupNet__UaClientLibraryHelper.html#gae9f5677b684b8965a39f25695fa292f0">RetryInitialConnect</a>.Yes,</div>
<div class="line">                    m_session.DefaultRequestSettings,</div>
<div class="line">                    OnReverseConnectCompleted,</div>
<div class="line">                    m_session);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (Exception e)</div>
<div class="line">            {</div>
<div class="line">                ExceptionDlg.ShowInnerException(this.Text, e);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnReverseConnectCompleted(IAsyncResult result)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// need to make sure the results are processed on the correct thread.</span></div>
<div class="line">            <span class="keywordflow">if</span> (InvokeRequired)</div>
<div class="line">            {</div>
<div class="line">                BeginInvoke(<span class="keyword">new</span> AsyncCallback(OnReverseConnectCompleted), result);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get the session used to send the request which was passed as the userData in the Begin call.</span></div>
<div class="line">            Session session = (Session)result.AsyncState;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">try</span></div>
<div class="line">            {</div>
<div class="line">                session.EndReverseConnect(result);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">catch</span> (Exception e)</div>
<div class="line">            {</div>
<div class="line">                ExceptionDlg.ShowInnerException(this.Text, e);</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ClientTutorials.html">Tutorials for Client development</a></li><li class="navelem"><a class="el" href="L2ClientTutExamples.html">Getting Started</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
