<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: KeyCredential support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ServerTuDemoServerKeyCredentials.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">KeyCredential support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#DemoServerKeyCredentialConfiguration">Configuration file additions</a></li>
<li class="level1"><a href="#DemoServerKeyCredentialCode">Code additions</a></li>
<li class="level1"><a href="#DemoServerKeyCredentialRetrieving">Retrieving KeyCredential</a></li>
</ul>
</div>
<div class="textblock"><p>The .NET server SDK supports the KeyCredentialConfiguration model that allows to manage KeyCredential through a client interface. This is used, for example, for the access configuration of Broker for PubSub. The interface and also its implementation in the server are purpose-independent, so that it can also be used for other services that require KeyCredentials. KeyCredentials comprise a CredentialId (e.g. a user name) and a Secret (e.g. a password). Which KeyCredential should be used for a service is specified by a ResourceUri, a ProfileUri and the EndpointUrl.</p>
<p>There are several advantages to keeping the KeyCredentials separate from the actual service configuration. The KeyCredentials can be stored in a different location (file, computer, database) and with higher security protections (encryption, file access rights). The configuration of the KeyCredentials can be restricted to users with other roles (ConfigureAdmin vs SecureAdmin role).</p>
<p>How and where the KeyCredentials are stored is in the hands of the application developer through their implementation of the <a class="el" href="interfaceUnifiedAutomation_1_1UaServer_1_1IKeyCredentialStore.html">IKeyCredendialStores</a> interface. The UaDemoServer contains a very basic KeyCredentialStore implementation. It is stored on the local file system and does not utilize any encryption.</p>
<h1><a class="anchor" id="DemoServerKeyCredentialConfiguration"></a>
Configuration file additions</h1>
<p>Since the configuration parameters for the KeyCredentialStore depend on its implementation, the server configuration schema does not have any parameters for the KeyCredentialStore. Fortunately, it is very easy to extended the configuration schema with custom extensions. For the UaDemoServer, only the file name to store the KeyCredentials is needed.</p>
<div class="fragment"><div class="line">    [Serializable]</div>
<div class="line">    [XmlType(Namespace = <span class="stringliteral">&quot;http://unifiedAutomation.com/configuration/DemoServer&quot;</span>)]</div>
<div class="line">    [XmlRoot(Namespace = <span class="stringliteral">&quot;http://unifiedAutomation.com/configuration/DemoServer&quot;</span>, IsNullable = <span class="keyword">false</span>)]</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>FileBasedKeyCredentialStoreSettings</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> FileName { <span class="keyword">get</span>; set; }</div>
<div class="line">    }</div>
</div><!-- fragment --><p> The path is than defined in the App.config file.</p>
<div class="fragment"><div class="line">&lt;Extensions&gt;</div>
<div class="line">  &lt;!--</div>
<div class="line">  ...</div>
<div class="line">  --&gt;</div>
<div class="line">  &lt;Extension&gt;</div>
<div class="line">    &lt;KeyCredentialSettings xmlns=<span class="stringliteral">&quot;http://unifiedAutomation.com/configuration/DemoServer&quot;</span>&gt;</div>
<div class="line">      &lt;FileName&gt;%CommonApplicationData%\unifiedautomation\UaSdkNet\Configuration\KeyCredentials.xml&lt;/FileName&gt;</div>
<div class="line">    &lt;/KeyCredentialSettings&gt;</div>
<div class="line">  &lt;/Extension&gt;</div>
<div class="line">&lt;/Extensions&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="DemoServerKeyCredentialCode"></a>
Code additions</h1>
<p>On startup the server manager will call the method <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html#a9179b53e87ee04c356d8104a7ab5d7c9">CreateKeyCredentialStore()</a>. By default this method will return <code>null</code>. The implementation of the UaDemoServer will try to retrieve the configured file name. If the name is set it will create an instance of the FileBasedKeyCredentialStore.</p>
<div class="fragment"><div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> IKeyCredentialStore CreateKeyCredentialStore()</div>
<div class="line">        {</div>
<div class="line">            var settingsName = <span class="keyword">new</span> XmlQualifiedName(<span class="stringliteral">&quot;KeyCredentialSettings&quot;</span>, <span class="stringliteral">&quot;http://unifiedAutomation.com/configuration/DemoServer&quot;</span>);</div>
<div class="line">            var config = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a96d16e9a0ffe0e31ca0315c51a54adcfae498749f3c42246d50b15c81c101d988">Application</a>.GetConfigurationExtension&lt;FileBasedKeyCredentialStoreSettings&gt;(<span class="keyword">true</span>, settingsName);</div>
<div class="line">            <span class="keywordflow">if</span> (config?.FileName is <span class="keywordtype">string</span> fileName)</div>
<div class="line">            {</div>
<div class="line">                fileName = FilePathUtils.GetAbsoluteFilePath(fileName, <span class="keyword">new</span> FilePathSettings()</div>
<div class="line">                {</div>
<div class="line">                    SuppressExceptions = <span class="keyword">true</span>,</div>
<div class="line">                    ReturnValidButMissing = <span class="keyword">true</span>,</div>
<div class="line">                });</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> FileBasedKeyCredentialStore.FromFile(fileName);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> null;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p> If the method <code>CreateKeyCredentialStore()</code> returns a value that is not <code>null</code>, the KeyCredentialConfiguration folder in the server address space will be present. and the KeyCredentials can be configured with a suitable client.</p>
<h1><a class="anchor" id="DemoServerKeyCredentialRetrieving"></a>
Retrieving KeyCredential</h1>
<p>On start up the ServerManager will call the method <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html#ab1397f5f114e2c48ecd188948c7593da">CreateKeyCredentialProvider()</a>. This will create an adapter for the KeyCredentialConfiguration model in the address space if present. The provider will be stored in the <a class="el" href="classUnifiedAutomation_1_1UaServer_1_1ServerManager.html#ac6624492fc6d286b2285604f3229700c">KeyCredentialProvider</a>. If the KeyCredentialConfiguration address space model is not used, the <code>CreateKeyCredentialProvider()</code> method can be overridden to use a different mechanism, such as a GUI dialog.</p>
<p>The KeyCredentialProvider can be used where ever the server needs access to KeyCredentials, for PubSub this will happen by default. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutDemoServer.html">.NET SDK Demo Server</a></li><li class="navelem"><a class="el" href="L3ServerTuDemoServerPubSub.html">PubSub support</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
