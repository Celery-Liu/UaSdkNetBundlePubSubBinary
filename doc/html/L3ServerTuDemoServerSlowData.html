<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>.NET Based OPC UA Client/Server/PubSub SDK: Slow Data Source Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header_inner_inner_bg2.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">.NET Based OPC UA Client/Server/PubSub SDK
   &#160;<span id="projectnumber">4.1.0.556</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('L3ServerTuDemoServerSlowData.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Slow Data Source Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#DemoServerExampleSlowVariablesBG">Background</a></li>
<li class="level1"><a href="#DemoServerExampleSlowVariablesDataSources">Data Sources</a></li>
<li class="level1"><a href="#DemoServerExampleSlowVariablesWrapper">Wrapper Classes</a></li>
<li class="level1"><a href="#DemoServerExampleSlowVariablesRead">Read</a><ul><li class="level2"><a href="#DemoServerExampleSlowVariablesReadSync">Synchronous</a></li>
<li class="level2"><a href="#DemoServerExampleSlowVariablesReadAsync">Asynchronous</a></li>
</ul>
</li>
<li class="level1"><a href="#DemoServerExampleSlowVariablesWrite">Write</a></li>
<li class="level1"><a href="#DemoServerExampleSlowVariablesMonitoring">Monitoring</a></li>
</ul>
</div>
<div class="textblock"><p>The Demo Server address space contains Variables that return their Read and Write results very slowly. They can be found in in the folder Demo → 017_SpecialVariables. The source code can be found in the file DemoNodeManager.SlowDataSource.cs</p>
<h1><a class="anchor" id="DemoServerExampleSlowVariablesBG"></a>
Background</h1>
<p>In real-world applications, nodes in UA servers may represent devices that are answering very slowly, e.g. in error case. If access to these data sources is implemented incorrectly, the server blocks as long as the call to the API of the data source is outstanding. The implementation in the server is different if the API for accessing the device is synchronous or asynchronous.</p>
<h1><a class="anchor" id="DemoServerExampleSlowVariablesDataSources"></a>
Data Sources</h1>
<p>In our example, there are classes that simulate slowly responding devices. The devices have methods for reading and writing. For simplicity, the device is represented by a single UINT32 value. There is also a simulation in the device classes: The value is incremented every 500&#160;ms (see sample code below).</p>
<div class="fragment"><div class="line"><span class="preprocessor">    #region Base class</span></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSource</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> SlowDataSource()</div>
<div class="line">        {</div>
<div class="line">            m_timer = <span class="keyword">new</span> Timer(DoUpdate, null, 500, 500);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">void</span> DoUpdate(<span class="keywordtype">object</span> state)</div>
<div class="line">        {</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                m_value++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> Dispose()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>(m_timer != null)</div>
<div class="line">            {</div>
<div class="line">                m_timer.Dispose();</div>
<div class="line">                m_timer = null;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">int</span> m_delay = 2000;</div>
<div class="line">        <span class="keyword">protected</span> uint m_value = 0;</div>
<div class="line">        <span class="keyword">private</span> Timer m_timer;</div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">object</span> m_lock = <span class="keyword">new</span> object();</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #endregion</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #region Synchronous API</span></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceSynchronousAPI : SlowDataSource</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> uint ReadValue()</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespaceSystem.html">System</a>.<a class="code" href="namespaceSystem_1_1Threading.html">Threading</a>.Thread.Sleep(m_delay);</div>
<div class="line">            uint ret;</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                ret = m_value;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">bool</span> WriteValue(uint value)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespaceSystem.html">System</a>.<a class="code" href="namespaceSystem_1_1Threading.html">Threading</a>.Thread.Sleep(m_delay);</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                m_value = value;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #endregion</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #region Asynchronous API</span></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceAsynchronousAPI : SlowDataSource</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> delegate <span class="keywordtype">void</span> ReadComplete(uint value, <span class="keywordtype">object</span> userData);</div>
<div class="line">        <span class="keyword">public</span> delegate <span class="keywordtype">void</span> WriteComplete(<span class="keywordtype">bool</span> status, <span class="keywordtype">object</span> userData);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> BeginRead(ReadComplete callback, <span class="keywordtype">object</span> userData)</div>
<div class="line">        {</div>
<div class="line">            ThreadPool.QueueUserWorkItem(Read, <span class="keyword">new</span> ReadData()</div>
<div class="line">            {</div>
<div class="line">                Callback = callback,</div>
<div class="line">                UserData = userData</div>
<div class="line">            });</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">class </span>ReadData</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">public</span> ReadComplete Callback { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">object</span> UserData { <span class="keyword">get</span>; set; }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca7a1a5f3e79fdc91edf2f5ead9d66abb4">Read</a>(<span class="keywordtype">object</span> state)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespaceSystem.html">System</a>.<a class="code" href="namespaceSystem_1_1Threading.html">Threading</a>.Thread.Sleep(m_delay);</div>
<div class="line">            ReadData data = state as ReadData;</div>
<div class="line">            ReadComplete callback = state as ReadComplete;</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                data.Callback(m_value, data.UserData);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> BeginWrite(uint value, WriteComplete callback, <span class="keywordtype">object</span> userData)</div>
<div class="line">        {</div>
<div class="line">            ThreadPool.QueueUserWorkItem(Write, <span class="keyword">new</span> WriteData()</div>
<div class="line">            {</div>
<div class="line">                Callback = callback,</div>
<div class="line">                Value = value,</div>
<div class="line">                UserData = userData</div>
<div class="line">            });</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca1129c0e4d43f2d121652a7302712cff6">Write</a>(<span class="keywordtype">object</span> state)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespaceSystem.html">System</a>.<a class="code" href="namespaceSystem_1_1Threading.html">Threading</a>.Thread.Sleep(m_delay);</div>
<div class="line">            WriteData data = state as WriteData;</div>
<div class="line">            WriteComplete callback = state as WriteComplete;</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                m_value = data.Value;</div>
<div class="line">            }</div>
<div class="line">            data.Callback(<span class="keyword">true</span>, data.UserData);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keyword">class </span>WriteData</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">public</span> WriteComplete Callback { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> uint Value { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">object</span> UserData { <span class="keyword">get</span>; set; }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #endregion</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="DemoServerExampleSlowVariablesWrapper"></a>
Wrapper Classes</h1>
<p>We create wrapper classes for the devices and use these wrappers to configure the variables (see sample code below). The main usage of these wrappers will be explained <a class="el" href="L3ServerTuDemoServerSlowData.html#DemoServerExampleSlowVariablesMonitoring">later</a> when the code for monitoring is added.</p>
<div class="fragment"><div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceWrapperSynchronous : SlowDataSourceWrapper</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceWrapperSynchronous(SlowDataSourceSynchronousAPI dataSource)</div>
<div class="line">        {</div>
<div class="line">            m_dataSource = dataSource;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceSynchronousAPI DataSource</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">get</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> m_dataSource;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --> <h1><a class="anchor" id="DemoServerExampleSlowVariablesRead"></a>
Read</h1>
<p>Reading the device values takes some time. So we must not read these values in the method</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca7a1a5f3e79fdc91edf2f5ead9d66abb4">Read</a>(</div>
<div class="line">            RequestContext context,</div>
<div class="line">            NodeAttributeHandle nodeHandle,</div>
<div class="line">            <span class="keywordtype">string</span> indexRange,</div>
<div class="line">            QualifiedName dataEncoding)</div>
</div><!-- fragment --><p>since the server would be blocked until this call has returned. So we need to call the Read method of the device in the method</p>
<div class="fragment"><div class="line"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a769000a8da22e528a1830197cf1bcd3ca7a1a5f3e79fdc91edf2f5ead9d66abb4">Read</a>(</div>
<div class="line">    RequestContext context,</div>
<div class="line">    TransactionHandle transaction,</div>
<div class="line">    IList&lt;NodeAttributeOperationHandle&gt; operationHandles,</div>
<div class="line">    IList&lt;ReadValueId&gt; settings)</div>
</div><!-- fragment --><p>and invoke the callback of the transaction when the read of the device has finished.</p>
<h2><a class="anchor" id="DemoServerExampleSlowVariablesReadSync"></a>
Synchronous</h2>
<p>For the synchronous API, we can use the ApplicationThreadPool to queue the Read calls. This example is designed to be adapted to other data sources. You only need to implement the ReadInJob delegate–the method OnReadSlowVariable in this case–and copy and paste the remaining code to your application.</p>
<div class="fragment"><div class="line">                <span class="keywordflow">if</span> (operationHandles[ii].NodeHandle.UserData is SlowDataSourceWrapperSynchronous)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// We have to read the value in a thread</span></div>
<div class="line">                    DoReadInJob(</div>
<div class="line">                        <span class="keyword">new</span> ReadInJobData()</div>
<div class="line">                        {</div>
<div class="line">                            Context = context,</div>
<div class="line">                            Transaction = transaction,</div>
<div class="line">                            OperationHandle = operationHandles[ii],</div>
<div class="line">                            ReadValueId = settings[ii],</div>
<div class="line">                            Callback = OnReadSlowVariable</div>
<div class="line">                        });</div>
<div class="line">                }</div>
</div><!-- fragment --><div class="fragment"><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> DoReadInJob(</div>
<div class="line">            ReadInJobData data</div>
<div class="line">            )</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a4ee1c62aa1346abfd54798f6d167a766a9aa1b03934893d7134a660af4204f2a9">Server</a>.ThreadPool.Queue(data, OnReadInJob);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnReadInJob(<span class="keywordtype">object</span> state, StatusCode error)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (error.IsBad())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            ReadInJobData data = state as ReadInJobData;</div>
<div class="line">            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> dv = data.Callback(data.ReadValueId, data.OperationHandle.NodeHandle);</div>
<div class="line">            ((<a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#add4c08a10b3e167349e94007924d24a0">ReadCompleteEventHandler</a>)data.Transaction.Callback)(</div>
<div class="line">                data.OperationHandle,</div>
<div class="line">                data.Transaction.CallbackData,</div>
<div class="line">                dv,</div>
<div class="line">                <span class="keyword">false</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        delegate <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> ReadInJob(ReadValueId nodeToRead, NodeAttributeHandle nodeHandle);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> OnReadSlowVariable(ReadValueId nodeToRead, NodeAttributeHandle nodeHandle)</div>
<div class="line">        {</div>
<div class="line">            SlowDataSourceWrapperSynchronous dataSourceWrapper = nodeHandle.UserData as SlowDataSourceWrapperSynchronous;</div>
<div class="line">            uint value = dataSourceWrapper.DataSource.ReadValue();</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a>()</div>
<div class="line">            {</div>
<div class="line">                WrappedValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a>(value),</div>
<div class="line">                SourceTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow,</div>
<div class="line">                ServerTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow</div>
<div class="line">            };</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">class </span>ReadInJobData</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">public</span> RequestContext Context { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> TransactionHandle Transaction { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> NodeAttributeOperationHandle OperationHandle { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> ReadValueId ReadValueId { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> ReadInJob Callback { <span class="keyword">get</span>; set; }</div>
<div class="line">        }</div>
</div><!-- fragment --> <h2><a class="anchor" id="DemoServerExampleSlowVariablesReadAsync"></a>
Asynchronous</h2>
<p>When using the asynchronous API, we can invoke the transaction callback in the callback of the data source:</p>
<div class="fragment"><div class="line">                    var dataSourceWrapper = operationHandles[ii].NodeHandle.UserData as SlowDataSourceWrapperAsynchronous;</div>
<div class="line">                    <span class="keywordflow">if</span> (dataSourceWrapper != null)</div>
<div class="line">                    {</div>
<div class="line">                        dataSourceWrapper.DataSource.BeginRead(OnSlowAsyncReadComplete, <span class="keyword">new</span> ReadAsyncData()</div>
<div class="line">                        {</div>
<div class="line">                            Transaction = transaction,</div>
<div class="line">                            OperationHandle = operationHandles[ii]</div>
<div class="line">                        });</div>
<div class="line">                    }</div>
<div class="line">                }</div>
</div><!-- fragment --><div class="fragment"><div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnSlowAsyncReadComplete(uint value, <span class="keywordtype">object</span> userData)</div>
<div class="line">        {</div>
<div class="line">            ReadAsyncData data = userData as ReadAsyncData;</div>
<div class="line">            <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> dv = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a>()</div>
<div class="line">            {</div>
<div class="line">                WrappedValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a>(value),</div>
<div class="line">                SourceTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow,</div>
<div class="line">                ServerTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow</div>
<div class="line">            };</div>
<div class="line">            ((<a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#add4c08a10b3e167349e94007924d24a0">ReadCompleteEventHandler</a>)data.Transaction.Callback)(</div>
<div class="line">                 data.OperationHandle,</div>
<div class="line">                 data.Transaction.CallbackData,</div>
<div class="line">                 dv,</div>
<div class="line">                 <span class="keyword">false</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">class </span>ReadAsyncData</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">public</span> TransactionHandle Transaction { <span class="keyword">get</span>; set; }</div>
<div class="line">            <span class="keyword">public</span> NodeAttributeOperationHandle OperationHandle { <span class="keyword">get</span>; set; }</div>
<div class="line">        }</div>
</div><!-- fragment --> <h1><a class="anchor" id="DemoServerExampleSlowVariablesWrite"></a>
Write</h1>
<p>The Write implementation is equivalent to the Read implementation and not therefore not shown in this documentation.</p>
<h1><a class="anchor" id="DemoServerExampleSlowVariablesMonitoring"></a>
Monitoring</h1>
<p>Even if the external data source is not event based and we can get current values only by calling a Read method, we must not set the NodeHandleType to ExternalPolled. Using this NodeHandleType could waste the threads of the ThreadPool (of the OPC UA server in the synchronous case or of the device in the asynchronous case). As a result, the server could block.</p>
<p>So we need to use the NodeHandleType ExternalPushed and do an own sampling of the data source. This sampling is done by the wrapper classes of the data source. If the first MonitoredItem is added to the wrapper, the sampling is started. If the last MonitoredItem is removed, the sampling is stopped again. Since we are using the NodeHandleType ExternalPushed we need to implement</p>
<ul>
<li>StartDataMonitoring</li>
<li>ModifyDataMonitoring</li>
<li>StopDataMonitoring</li>
<li>SetDataMonitoringMode</li>
</ul>
<p>In these methods, the MonitoredItems are added to and removed from the wrapper classes:</p>
<div class="fragment"><div class="line">        <span class="keyword">private</span> DataMonitoringResult StartDataMonitoringSlowVariables(</div>
<div class="line">            RequestContext context,</div>
<div class="line">            MonitoredItemHandle itemHandle,</div>
<div class="line">            MonitoredItemCreateRequest settings,</div>
<div class="line">            DataChangeEventHandler callback)</div>
<div class="line">        {</div>
<div class="line">            DataMonitoringResult result = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a4ee1c62aa1346abfd54798f6d167a766a9aa1b03934893d7134a660af4204f2a9">Server</a>.ValidateDataMonitoringRequest(</div>
<div class="line">                context,</div>
<div class="line">                itemHandle.NodeHandle,</div>
<div class="line">                settings.ItemToMonitor,</div>
<div class="line">                settings.RequestedParameters,</div>
<div class="line">                null);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (result.StatusCode.IsBad())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> result;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            SlowDataSourceWrapper dataSourceWrapper = itemHandle.NodeHandle.UserData as SlowDataSourceWrapper;</div>
<div class="line"></div>
<div class="line">            dataSourceWrapper.AddMonitoredItem(<span class="keyword">new</span> SlowDataSourceWrapperMonitoredItem()</div>
<div class="line">            {</div>
<div class="line">                ItemHandle = itemHandle,</div>
<div class="line">                <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a2860108324a51868b8932c497a64e7c1">MonitoringMode</a> = settings.MonitoringMode,</div>
<div class="line">                SamplingInterval = (int)settings.RequestedParameters.SamplingInterval,</div>
<div class="line">                Callback = callback</div>
<div class="line">            });</div>
<div class="line"></div>
<div class="line">            result.RevisedSamplingInterval = ReviseSamplingInterval(settings.RequestedParameters.SamplingInterval);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> result;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> DataMonitoringResult ModifyDataMonitoringSlowVariables(</div>
<div class="line">            RequestContext context,</div>
<div class="line">            MonitoredItemHandle itemHandle,</div>
<div class="line">            MonitoredItemModifyRequest settings)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// validate request.</span></div>
<div class="line">            DataMonitoringResult result = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a4ee1c62aa1346abfd54798f6d167a766a9aa1b03934893d7134a660af4204f2a9">Server</a>.ValidateDataMonitoringRequest(</div>
<div class="line">                context,</div>
<div class="line">                itemHandle.NodeHandle,</div>
<div class="line">                null,</div>
<div class="line">                settings.RequestedParameters,</div>
<div class="line">                null);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (result.StatusCode.IsBad())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> result;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            result.RevisedSamplingInterval = ReviseSamplingInterval(settings.RequestedParameters.SamplingInterval);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> result;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a>? StopDataMonitoringSlowVariables(</div>
<div class="line">            RequestContext context,</div>
<div class="line">            MonitoredItemHandle itemHandle)</div>
<div class="line">        {</div>
<div class="line">            SlowDataSourceWrapper dataSourceWrapper = itemHandle.NodeHandle.UserData as SlowDataSourceWrapper;</div>
<div class="line">            dataSourceWrapper.RemoveMonitoredItem(itemHandle);</div>
<div class="line">            <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a72381d4605940627a6e846d5f3155c51">StatusCode</a>? SetDataMonitoringModeSlowVariables(</div>
<div class="line">            RequestContext context,</div>
<div class="line">            MonitoredItemHandle itemHandle,</div>
<div class="line">            MonitoringMode monitoringMode,</div>
<div class="line">            MonitoringParameters parameters)</div>
<div class="line">        {</div>
<div class="line">            SlowDataSourceWrapper dataSourceWrapper = itemHandle.NodeHandle.UserData as SlowDataSourceWrapper;</div>
<div class="line">            dataSourceWrapper.SetMonitoringMode(itemHandle, monitoringMode, parameters);</div>
<div class="line">            <span class="keywordflow">return</span> StatusCodes.Good;</div>
<div class="line">        }</div>
</div><!-- fragment --><div class="fragment"><div class="line">    <span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="keyword">class </span>SlowDataSourceWrapper</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceWrapper()</div>
<div class="line">        {</div>
<div class="line">            m_lock = <span class="keyword">new</span> object();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> AddMonitoredItem(SlowDataSourceWrapperMonitoredItem monitoredItem)</div>
<div class="line">        {</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (m_monitoredItems == null)</div>
<div class="line">                {</div>
<div class="line">                    m_monitoredItems = <span class="keyword">new</span> List&lt;SlowDataSourceWrapperMonitoredItem&gt;();</div>
<div class="line">                }</div>
<div class="line">                m_monitoredItems.Add(monitoredItem);</div>
<div class="line">                <span class="keywordtype">int</span> lastSamplingInterval = m_currentSamplingInterval;</div>
<div class="line">                UpdatePolling();</div>
<div class="line">                <span class="keywordflow">if</span> (m_lastValue != null &amp;&amp; m_currentSamplingInterval == lastSamplingInterval)</div>
<div class="line">                {</div>
<div class="line">                    monitoredItem.Callback(null, monitoredItem.ItemHandle, m_lastValue, <span class="keyword">false</span>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    monitoredItem.Callback(null, monitoredItem.ItemHandle, <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a>(StatusCodes.BadWaitingForInitialData), <span class="keyword">false</span>);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">bool</span> RemoveMonitoredItem(MonitoredItemHandle itemHandle)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">bool</span> itemRemoved = <span class="keyword">false</span>;</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (m_monitoredItems == null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">foreach</span> (SlowDataSourceWrapperMonitoredItem monitoredItem <span class="keywordflow">in</span> m_monitoredItems)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (monitoredItem.ItemHandle == itemHandle)</div>
<div class="line">                    {</div>
<div class="line">                        m_monitoredItems.Remove(monitoredItem);</div>
<div class="line">                        itemRemoved = <span class="keyword">true</span>;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (m_monitoredItems.Count == 0)</div>
<div class="line">                {</div>
<div class="line">                    m_timer.Dispose();</div>
<div class="line">                    m_timer = null;</div>
<div class="line">                    m_instance = null;</div>
<div class="line">                    m_lastValue = null;</div>
<div class="line">                    m_currentSamplingInterval = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    UpdatePolling();</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> itemRemoved;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#a02628a09167aaf601b57782c5a5fe8deac3ac1f23e143d364432e0ed80b87a0d0">SetMonitoringMode</a>(</div>
<div class="line">            MonitoredItemHandle itemHandle,</div>
<div class="line">            MonitoringMode monitoringMode,</div>
<div class="line">            MonitoringParameters parameters)</div>
<div class="line">        {</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">foreach</span> (var monitoredItem <span class="keywordflow">in</span> m_monitoredItems)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (monitoredItem.ItemHandle == itemHandle)</div>
<div class="line">                    {</div>
<div class="line">                        monitoredItem.SamplingInterval = (int)parameters.SamplingInterval;</div>
<div class="line">                        monitoredItem.MonitoringMode = monitoringMode;</div>
<div class="line">                        UpdatePolling();</div>
<div class="line">                        monitoredItem.Callback(null, monitoredItem.ItemHandle, m_lastValue, <span class="keyword">false</span>);</div>
<div class="line">                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">void</span> UpdatePolling()</div>
<div class="line">        {</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span> samplingInterval = NewSamplingInterval();</div>
<div class="line">                <span class="keywordflow">if</span> (samplingInterval &lt; m_currentSamplingInterval || m_currentSamplingInterval == 0)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (m_timer != null)</div>
<div class="line">                    {</div>
<div class="line">                        m_timer.Dispose();</div>
<div class="line">                        m_lastValue = null;</div>
<div class="line">                    }</div>
<div class="line">                    m_instance = <span class="keyword">new</span> object();</div>
<div class="line">                    m_timer = <span class="keyword">new</span> Timer(OnPoll, m_instance, 0, samplingInterval);</div>
<div class="line">                    m_currentSamplingInterval = samplingInterval;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">int</span> NewSamplingInterval()</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">int</span> newSamplingInterval = 5000;</div>
<div class="line">            <span class="keywordflow">foreach</span> (SlowDataSourceWrapperMonitoredItem monitoredItem <span class="keywordflow">in</span> m_monitoredItems)</div>
<div class="line">            {</div>
<div class="line">                newSamplingInterval = Math.Min(newSamplingInterval, (<span class="keywordtype">int</span>)monitoredItem.SamplingInterval);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (newSamplingInterval &lt;= 250)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> 250;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (newSamplingInterval &lt;= 1000)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> 1000;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 5000;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> OnPoll(<span class="keywordtype">object</span> state);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">object</span> m_lock;</div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">object</span> m_instance;</div>
<div class="line">        <span class="keyword">protected</span> Timer m_timer;</div>
<div class="line">        <span class="keyword">protected</span> List&lt;SlowDataSourceWrapperMonitoredItem&gt; m_monitoredItems;</div>
<div class="line">        <span class="keyword">protected</span> <span class="keywordtype">int</span> m_currentSamplingInterval;</div>
<div class="line">        <span class="keyword">protected</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a> m_lastValue;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceWrapperSynchronous : SlowDataSourceWrapper</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceWrapperSynchronous(SlowDataSourceSynchronousAPI dataSource)</div>
<div class="line">        {</div>
<div class="line">            m_dataSource = dataSource;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceSynchronousAPI DataSource</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">get</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> m_dataSource;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPoll(<span class="keywordtype">object</span> state)</div>
<div class="line">        {</div>
<div class="line">            uint value = m_dataSource.ReadValue();</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (m_instance == state)</div>
<div class="line">                {</div>
<div class="line">                    m_lastValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a>()</div>
<div class="line">                    {</div>
<div class="line">                        WrappedValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a>(value),</div>
<div class="line">                        SourceTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow,</div>
<div class="line">                        ServerTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow</div>
<div class="line">                    };</div>
<div class="line">                    <span class="keywordflow">foreach</span> (SlowDataSourceWrapperMonitoredItem monitoredItem <span class="keywordflow">in</span> m_monitoredItems)</div>
<div class="line">                    {</div>
<div class="line">                        monitoredItem.Callback(null, monitoredItem.ItemHandle, m_lastValue, <span class="keyword">false</span>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> readonly SlowDataSourceSynchronousAPI m_dataSource;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceWrapperAsynchronous : SlowDataSourceWrapper</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceWrapperAsynchronous(SlowDataSourceAsynchronousAPI dataSource)</div>
<div class="line">        {</div>
<div class="line">            m_dataSource = dataSource;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">public</span> SlowDataSourceAsynchronousAPI DataSource</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">get</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> m_dataSource;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnPoll(<span class="keywordtype">object</span> state)</div>
<div class="line">        {</div>
<div class="line">            m_dataSource.BeginRead(OnReadComplete, state);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> OnReadComplete(uint value, <span class="keywordtype">object</span> userData)</div>
<div class="line">        {</div>
<div class="line">            lock (m_lock)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (m_instance == userData)</div>
<div class="line">                {</div>
<div class="line">                    m_lastValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328ac7859cb58bee902dc86f1742665ff96f">DataValue</a>()</div>
<div class="line">                    {</div>
<div class="line">                        WrappedValue = <span class="keyword">new</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a492f18b60811bf85ce118c0c6a1a5c4a">Variant</a>(value),</div>
<div class="line">                        SourceTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow,</div>
<div class="line">                        ServerTimestamp = <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a5c65b5d5d05c3f82bdeef88928d74328a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow</div>
<div class="line">                    };</div>
<div class="line">                    <span class="keywordflow">foreach</span> (SlowDataSourceWrapperMonitoredItem monitoredItem <span class="keywordflow">in</span> m_monitoredItems)</div>
<div class="line">                    {</div>
<div class="line">                        monitoredItem.Callback(null, monitoredItem.ItemHandle, m_lastValue, <span class="keyword">false</span>);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">private</span> readonly SlowDataSourceAsynchronousAPI m_dataSource;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">internal</span> <span class="keyword">class </span>SlowDataSourceWrapperMonitoredItem</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> MonitoredItemHandle ItemHandle { <span class="keyword">get</span>; set; }</div>
<div class="line">        <span class="keyword">public</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a2860108324a51868b8932c497a64e7c1">MonitoringMode</a> <a class="code" href="namespaceUnifiedAutomation_1_1UaBase.html#a2860108324a51868b8932c497a64e7c1">MonitoringMode</a> { <span class="keyword">get</span>; set; }</div>
<div class="line">        <span class="keyword">public</span> <span class="keywordtype">int</span> SamplingInterval { <span class="keyword">get</span>; set; }</div>
<div class="line">        <span class="keyword">public</span> <a class="code" href="namespaceUnifiedAutomation_1_1UaServer.html#a0bb719d94f9af66957b15d9ff78cee7e">DataChangeEventHandler</a> Callback { <span class="keyword">get</span>; set; }</div>
<div class="line">    }</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="L1ServerTutorials.html">Tutorials for Server development</a></li><li class="navelem"><a class="el" href="L2ServerTutDemoServer.html">.NET SDK Demo Server</a></li>
    <li class="footer">&copy; Unified Automation GmbH - All rights reserved.</li>
  </ul>
</div>
</body>
</html>
